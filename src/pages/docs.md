# AI 写作助手使用指南

## 📚 目录导航

- [项目介绍](#项目介绍)
- [AI 科普](#ai-科普)
- [使用说明](#使用说明)
- [常见问题](#常见问题)

---

## 项目介绍

- **完全免费**：应用本身免费开源，不收取任何费用。
- **需要准备**：首次使用需要你自己的 AI 服务商 **API 密钥**（Key）。没有密钥就无法联网生成回答。
- **开源地址**：[GitHub 仓库](https://github.com/afigzb/windowAIChat)

---

## AI 科普

这个项目中有许多乱七八糟的功能，为了降低大家的使用负担，我打算在这里先写一个关于ai的科普，当然以下内容仅作简单的科普了解：

### 一、AI 对话的三层结构

在一次 AI 对话中，信息通常分为三个部分：

- **System（系统层）**：定义 AI 的行为准则和身份，比如"你是一个写作助手"或"请始终使用正式语气回答"。
- **User（用户层）**：由用户输入的内容，例如"帮我写一篇关于家的作文"。
- **Assistant（助手层）**：AI 的回复内容。

从优先级上来说，它们的影响力依次为：**System > User > Assistant**。

换句话说，System 是"规则"，User 是"指令"，Assistant 是"执行结果"。

### 二、信息读取与"权重"

AI 模型并不是平均地读取全部内容，它更容易读取到最顶部（System）和最尾部（你刚输入的内容）的信息。

这就意味着：
- 越靠近顶部或底部的内容，模型越容易"记住"；
- 越靠中间的旧内容，随着对话变长，越容易被"淡化"或"遗忘"。

System 层的信息虽然拥有最高优先级，但并非永久有效。当输入内容过长、信息量过大时，即便是放在 System 层或最后一条消息，也可能因为模型的注意力被分散而出现丢失或误读。

### 三、上下文漂移

所谓"上下文漂移"，是指 AI 在长对话或复杂语境中，逐渐偏离最初设定或主题的现象。

造成漂移的常见原因包括：

1. **信息量过大**：当输入内容过多时，模型的注意力被稀释，顶部的规则或早期语境影响力减弱。

2. **语义冲突**：当多段内容相似但含义不同，例如：
   - 用户：请写一篇《家的作文》
   - AI：写出了一篇"爸爸妈妈的作文"
   - 用户：不对，我说的"家"是物理意义上的"家"
   
   这时两段内容都涉及"家""作文"等相似语义，AI 在判断哪一段才是"最新且正确"的语境时就容易混淆，最终输出可能不符合预期。

3. **上下文链条过长**：模型会优先关注近期的对话，而早期信息逐渐模糊，导致输出结果偏离初衷。

### 四、上下文的真相

很多人可能会误以为每次发送消息时，AI 只能看到"当前这一条"。

实际上，每次你点击发送，AI 收到的是从对话开始至今的完整历史——包括你说过的每一句话、AI 回复过的每一段内容。

这意味着：
- 对话越长，每次请求 AI 需要"重新阅读"的内容就越多；
- 如果不做上下文管理，信息会持续堆积，导致费用增加、响应变慢、注意力分散、甚至超出模型限制。

这也解释了为什么"上下文漂移"会发生——因为模型在处理海量历史信息时，难以持续聚焦于最初的目标。

### 五、AI 的本质：预测而非推理

当前主流 AI 模型（GPT、Claude 等）本质上是"下一个词预测器"，而非真正的推理引擎。

它在生成每个词时，依据的是"在这个上下文中，下一个词最可能是什么"，而不是像人类那样先构建完整逻辑再表达。

由此带来的局限：
- 复杂推理容易出错（多步骤逻辑、需要回溯的问题）；
- 无法自我纠错（生成是单向流式的，单次输出中不会出现自我纠错的情况）；
- 对提示词高度敏感（措辞、格式、顺序都会影响输出）。

### 六、幻觉的根源

正因为 AI 依靠"模式匹配"而非"真实理解"，当遇到训练数据中没有的内容、或问题表述模糊时，它会用"听起来最合理"的内容填补空白——这就是"幻觉"。

常见表现：
- 编造不存在的论文、书籍、链接；
- 虚构日期、人名、数据；
- 用流畅且逻辑自洽的语言，描述完全错误的事实。

这也解释了两个常见困扰：

1. **为什么 AI 生成的内容有时看起来很"蠢"？**
   
   因为它不理解语义，只是在拼接"看起来合理"的词。当上下文复杂、或训练数据中类似模式较少时，输出就会显得生硬、重复、逻辑混乱。

2. **为什么明明给了设定，AI 还是不遵守？**
   
   设定只是"影响概率"的因素之一，而非"强制规则"。当上下文中有其他更强的模式（比如长对话中的旧内容、相似语义的干扰），模型的注意力就会被分散，导致"忘记"或"误读"设定。

### 七、提示词工程

既然 AI 高度依赖"模式匹配"和"上下文"，如何表达指令就变得至关重要。

核心原则：

1. **具体而非模糊**："帮我写点东西" → "写一篇 800 字高中作文，主题'家乡的变化'，要求包含具体事例，语言朴实"。

2. **提供示例（Few-shot）**："用简洁风格" → "像这样：'春天来了。花开了。'（短句、句号、少形容词）"。

3. **拆解复杂任务**：不要一次性要求"写论文+大纲+参考文献"，而是分步："先列大纲" → "写第一章" → "写第二章"。

4. **定义角色**：在 System 层或开头明确身份，如"你是专业小说编辑，擅长情节设计"。

5. **用约束代替期待**："希望语言优美" → "每段必须包含至少一个比喻或排比句"。

### 八、上下文管理

正如"四、上下文的真相"所述，对话历史会持续堆积，导致费用、速度、质量三重问题。

因此需要主动管理上下文：

**常见策略：**

1. **定期清理**：删除无关紧要的旧对话，只保留核心设定和近期内容。
2. **总结压缩**：将长段对话总结成简短描述（如"已完成角色设定：男主角性格内向"），替换原始内容。
3. **分段对话**：长篇写作时，不要在一个对话中从头写到尾，而是按章节或段落分开多个独立对话。
4. **重要信息置顶**：把不能丢失的核心设定（如人物性格、世界观规则）放在 System 层或每次对话的开头。

管理的目的不是"省钱"，而是让 AI 的注意力集中在真正重要的信息上，从而提升输出质量。

---

## 使用说明

### 三步开始使用

1) **选择服务商**（两类都支持）
   - **OpenAI 兼容**：如 DeepSeek、通义千问（阿里云 DashScope）、智谱 AI、OpenAI 等。
   - **Google Gemini**：Google AI Studio / Vertex AI。

2) **申请并复制 API 密钥（Key）**
   - OpenAI 平台： [platform.openai.com](https://platform.openai.com/)（控制台与文档）
   - 阿里云 DashScope（通义千问）：[dashscope.aliyun.com](https://dashscope.aliyun.com/)（控制台） 
   - 智谱 AI： [open.bigmodel.cn](https://open.bigmodel.cn/)
   - Google AI Studio（Gemini）：[ai.google.dev](https://ai.google.dev/)
   - Deepseek AI : [platform.deepseek.com](https://platform.deepseek.com/usage)
   - 其他 OpenAI 兼容平台：在其控制台申请 Key。
   - 如果链接有误，直接在浏览器搜索“服务商名 + API”。

3) **在应用中填写配置**
   - 打开应用右上角或侧边栏的`设置` → `API 配置`。
   - 点击“新建配置”：
     - `类型`：选`openai`（OpenAI 兼容）或`gemini`（Google）。
     - `基础地址`（Base URL）：服务商接口地址（见下文）。
     - `API 密钥`：粘贴刚复制的 Key。
     - `模型`：在服务商文档或控制台查看模型名称并填写。
     - 保存后返回聊天页面开始使用。

### 我该选哪个"类型"？

在填写配置时，需要选择合适的类型：

- **选`openai`**：当你使用 DeepSeek、通义千问、智谱 AI、OpenAI 等"OpenAI 兼容接口"的服务商。
- **选`gemini`**：当你使用 Google Gemini。

常见 Base URL（仅作示例，最终以服务商文档为准）（注意，这里用的是 OpenAI 兼容接口）：
- OpenAI 兼容（示例）：`https://api.deepseek.com/v1/chat/completions`
- Gemini（示例）：`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro`

### 两种配置方式

- **表单配置（推荐）**：最简单，填 Key、Base URL、模型即可开始，使用的是默认参数。
- **代码编辑（进阶）**：直接编辑 JSON，可自定义参数，具体使用需参考服务商 API 文档；。

代码模式开启后，应用会用你提供的 JSON 作为请求体的补充/覆盖（上下文相关字段`messages/contents/systemInstruction`仍由应用统一生成以保证对话一致性）。

### 最小可用配置示例（可选）

#### OpenAI 兼容

适用于 OpenAI、DeepSeek、通义千问、智谱 AI 等 OpenAI 兼容服务：

```json
{
  "model": "deepseek-reasoner",
  "messages": [
    {"role": "system", "content": "你是AI写作助手，帮助用户完成小说写作。"}
  ],
  "stream": true,
  "max_tokens": 64000
}
```

#### Google Gemini

适用于 Google Gemini：

```json
{
  "model": "gemini-2.5-pro",
  "systemInstruction": {
    "parts": [
      { "text": "你是 AI 写作助手，帮助用户完成小说创作。" }
    ]
  },
  "generationConfig": {
    "temperature": 0.7,
    "maxOutputTokens": 65536,
    "topP": 0.9,
    "topK": 40,
    "candidateCount": 1,
    "thinkingConfig": {
      "includeThoughts": true,
      "thinkingBudget": -1
    },
    "responseMimeType": "text/plain"
  },
  "safetySettings": [
    { "category": "HARM_CATEGORY_HATE_SPEECH", "threshold": "BLOCK_NONE" },
    { "category": "HARM_CATEGORY_HARASSMENT", "threshold": "BLOCK_NONE" },
    { "category": "HARM_CATEGORY_SEXUALLY_EXPLICIT", "threshold": "BLOCK_NONE" },
    { "category": "HARM_CATEGORY_DANGEROUS_CONTENT", "threshold": "BLOCK_NONE" }
  ]
}
```

### 上下文与提示词

- **提示词卡片**
  - 应用内置常用提示词，可在`设置 → 常用提示词`中自行添加或删除。
  - 用户提示词采用追加逻辑，可自行选择在system，system后第一条，或用户本轮发送消息末尾追加提示词。
  - 系统提示词采用覆盖逻辑，会临时覆盖用户提示词，对用户提示词本身无影响，目前仅在生成摘要时使用。
- **临时上下文**：被选择的文件会以临时上下文附加到本轮请求末尾，不保留到对话历史，可用于生成摘要。
- **历史消息限制**：`历史上限（historyLimit）`控制每次请求携带的最近 N 轮，以控制成本与长度，被截取的历史不参与摘要。

### 一点点原理

- **模型更看重"开头与结尾"的内容**，关键约束尽量放两端。
- **上下文长度有限**：模型有总上下文上限（输入+输出）；过长会被截断。
- **最大输出令牌数**：仅限制回答长度，不等于模型可读取的总长度。

---

## 常见问题

- **为什么没有回应/一直失败？**
  - 是否已在`设置 → API 配置`中填写并保存 Key？
  - `基础地址`是否正确（OpenAI 兼容与 Gemini 不同，需按文档填写）？
  - `模型名`是否准确无误、该账号是否有权限调用该模型？
  - 网络是否可访问目标服务商（公司/学校网络可能拦截）？
  - 账号余额、配额、并发/速率是否受限？
  - 若开启了“代码编辑”，对应模型是否支持该参数？

- **模型名称在哪里查看？**
  - 登录服务商控制台或查阅其“模型列表/API 文档”。不同服务商命名不同，请以官方为准。

- **这款应用收费吗？**
  - 应用本身免费、开源；调用第三方 API 会由各服务商计费。

- **数据存放在哪里？**
  - 本地数据路径（通常）：`C:\\Users\\你的用户名\\AppData\\Roaming\\ai-writing-assistant\\app_data`
