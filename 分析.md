# AIå†™ä½œåŠ©æ‰‹ - é¡¹ç›®æ·±åº¦åˆ†ææŠ¥å‘Š

> åˆ†ææ—¥æœŸï¼š2025å¹´10æœˆ2æ—¥  
> é¡¹ç›®ç‰ˆæœ¬ï¼š1.0.0  
> æŠ€æœ¯æ ˆï¼šElectron + React + TypeScript + Vite

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½

**AIå†™ä½œåŠ©æ‰‹**æ˜¯ä¸€æ¬¾åŸºäº Electron çš„æ¡Œé¢åº”ç”¨ç¨‹åºï¼Œå°†æ–‡æ¡£ç¼–è¾‘ä¸ AI å¯¹è¯èƒ½åŠ›æ·±åº¦æ•´åˆã€‚é¡¹ç›®å®šä½ä¸º**ä¸“ä¸šçš„å†™ä½œè¾…åŠ©å·¥å…·**ï¼Œé¢å‘éœ€è¦åœ¨å†™ä½œè¿‡ç¨‹ä¸­é¢‘ç¹ä¸ AI äº¤äº’çš„ç”¨æˆ·ç¾¤ä½“ã€‚

**æ ¸å¿ƒä»·å€¼ä¸»å¼ **ï¼š
- å·¦ä¾§æ–‡ä»¶ç®¡ç†ã€ä¸­é—´æ–‡æ¡£ç¼–è¾‘ã€å³ä¾§ AI å¯¹è¯çš„ä¸‰æ å¸ƒå±€
- æ”¯æŒé€‰æ‹©å¤šä¸ªæ–‡ä»¶ä½œä¸ºä¸Šä¸‹æ–‡ä¸ AI å¯¹è¯
- ç‹¬ç«‹çš„æç¤ºè¯ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå¤šå¡ç‰‡å åŠ 
- è·¨å¹³å°æ”¯æŒï¼ˆWindowsã€macOSã€Linuxï¼‰

### 1.2 æŠ€æœ¯é€‰å‹

| æŠ€æœ¯é¢†åŸŸ | é€‰å‹ | ç‰ˆæœ¬ |
|---------|------|------|
| **æ¡Œé¢æ¡†æ¶** | Electron | 37.2.4 |
| **UIæ¡†æ¶** | React | 19.1.0 |
| **ç±»å‹ç³»ç»Ÿ** | TypeScript | 5.8.3 |
| **æ„å»ºå·¥å…·** | Vite | 6.3.5 |
| **æ ·å¼æ–¹æ¡ˆ** | Tailwind CSS | 4.0.0 |
| **Markdownæ¸²æŸ“** | react-markdown | 10.1.0 |
| **ä»£ç é«˜äº®** | react-syntax-highlighter | 15.6.1 |
| **æ•°å­¦å…¬å¼** | KaTeX (rehype-katex) | 7.0.1 |
| **æ–‡æ¡£å¤„ç†** | docx + mammoth | 9.5.1 + 1.9.1 |
| **å¸ƒå±€ç®¡ç†** | react-resizable-panels | 3.0.4 |

---

## äºŒã€æ¶æ„è®¾è®¡åˆ†æ

### 2.1 æ•´ä½“æ¶æ„

é¡¹ç›®é‡‡ç”¨ç»å…¸çš„ **Electron å¤šè¿›ç¨‹æ¶æ„** + **React å•é¡µåº”ç”¨**æ¨¡å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Electron ä¸»è¿›ç¨‹                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Application (main.js)                       â”‚   â”‚
â”‚  â”‚  â”œâ”€ WindowManager  (çª—å£ç®¡ç†)                â”‚   â”‚
â”‚  â”‚  â”œâ”€ StorageManager (æŒä¹…åŒ–å­˜å‚¨)              â”‚   â”‚
â”‚  â”‚  â”œâ”€ FileSystemManager (æ–‡ä»¶ç³»ç»Ÿ)             â”‚   â”‚
â”‚  â”‚  â”œâ”€ GlobalContextMenuManager (å³é”®èœå•)      â”‚   â”‚
â”‚  â”‚  â””â”€ DocxHandler (DOCXè½¬æ¢)                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†• IPC                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Preload (preload.js)                        â”‚   â”‚
â”‚  â”‚  æš´éœ²å®‰å…¨çš„ API ç»™æ¸²æŸ“è¿›ç¨‹                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Electron æ¸²æŸ“è¿›ç¨‹ (React)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  App.tsx (è·¯ç”±å…¥å£)                           â”‚   â”‚
â”‚  â”‚  â”œâ”€ WritingPage (å†™ä½œé¡µé¢ - ä¸»çª—å£)          â”‚   â”‚
â”‚  â”‚  â””â”€ PromptTemplatePage (æç¤ºè¯é¡µé¢ - ç‹¬ç«‹çª—å£)â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ ¸å¿ƒæ¨¡å—                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ chat/ (AIå¯¹è¯ç³»ç»Ÿ)                        â”‚   â”‚
â”‚  â”‚  â”œâ”€ writing/ (æ–‡æ¡£ç¼–è¾‘)                       â”‚   â”‚
â”‚  â”‚  â”œâ”€ prompt/ (æç¤ºè¯ç®¡ç†)                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ md-html-dock/ (æ–‡æ¡£æ¸²æŸ“)                  â”‚   â”‚
â”‚  â”‚  â””â”€ storage/ (å‰ç«¯å­˜å‚¨å°è£…)                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¨¡å—åŒ–è®¾è®¡

#### 2.2.1 ä¸»è¿›ç¨‹æ¨¡å—åŒ–ï¼ˆElectronç«¯ï¼‰

**ä¼˜ç§€çš„å•ä¸€èŒè´£è®¾è®¡**ï¼š
- `WindowManager`: ä¸“æ³¨çª—å£ç”Ÿå‘½å‘¨æœŸç®¡ç†
- `StorageManager`: æä¾›é”®å€¼å¯¹å­˜å‚¨èƒ½åŠ›ï¼Œæ”¯æŒåŒæ­¥/å¼‚æ­¥API
- `FileSystemManager`: å°è£…æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- `GlobalContextMenuManager`: ç»Ÿä¸€å¤„ç†å³é”®èœå•
- `DocxHandler`: DOCXæ ¼å¼è½¬æ¢çš„ç‹¬ç«‹æ¨¡å—

**IPCé€šä¿¡è®¾è®¡**ï¼šé‡‡ç”¨ `ipcMain.handle` + `ipcRenderer.invoke` çš„å¼‚æ­¥æ¨¡å¼ï¼Œé¿å…äº† `remote` æ¨¡å—çš„å®‰å…¨éšæ‚£ã€‚

#### 2.2.2 æ¸²æŸ“è¿›ç¨‹æ¨¡å—åŒ–ï¼ˆReactç«¯ï¼‰

**chatæ¨¡å— - AIå¯¹è¯ç³»ç»Ÿ**ï¼š

```
chat/
â”œâ”€â”€ adapters/           # é€‚é…å™¨æ¨¡å¼ - æ”¯æŒå¤šç§AIæä¾›å•†
â”‚   â”œâ”€â”€ openai-adapter.ts    # OpenAIå…¼å®¹API
â”‚   â””â”€â”€ gemini-adapter.ts    # Gemini API
â”œâ”€â”€ core/               # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ api.ts                # ç»Ÿä¸€APIè°ƒç”¨æ¥å£
â”‚   â”œâ”€â”€ conversation-manager.ts  # å¯¹è¯çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ branch-manager.ts        # å¯¹è¯åˆ†æ”¯ç®¡ç†
â”‚   â”œâ”€â”€ conversation-history.ts  # å†å²è®°å½•æŒä¹…åŒ–
â”‚   â”œâ”€â”€ tree-utils.ts            # æ ‘å½¢æ•°æ®ç»“æ„å·¥å…·
â”‚   â””â”€â”€ context/                 # ä¸Šä¸‹æ–‡å¼•æ“ï¼ˆäº®ç‚¹ï¼‰
â”‚       â”œâ”€â”€ engine.ts            # ContextEngineæ ¸å¿ƒ
â”‚       â”œâ”€â”€ message-editor.ts    # æ¶ˆæ¯ç¼–è¾‘å™¨
â”‚       â”œâ”€â”€ message-operators.ts # æ“ä½œç¬¦æ¨¡å¼
â”‚       â””â”€â”€ system-prompt.ts     # ç³»ç»Ÿæç¤ºè¯ç®¡ç†
â”œâ”€â”€ ui/                 # UIç»„ä»¶
â”‚   â”œâ”€â”€ ChatPanel.tsx
â”‚   â”œâ”€â”€ MessageBubble.tsx
â”‚   â””â”€â”€ ChatInput.tsx
â””â”€â”€ types.ts            # ç±»å‹å®šä¹‰
```

**writingæ¨¡å— - æ–‡æ¡£ç¼–è¾‘**ï¼š

```
writing/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ DocxEditor.tsx       # ContentEditableå¯Œæ–‡æœ¬ç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ FileTreePanel.tsx    # æ–‡ä»¶æ ‘ç»„ä»¶
â”‚   â”œâ”€â”€ FileTreeNode.tsx     # æ–‡ä»¶èŠ‚ç‚¹ï¼ˆæ”¯æŒå†…è”ç¼–è¾‘ï¼‰
â”‚   â””â”€â”€ DocsPage.tsx         # è¯´æ˜æ–‡æ¡£é¡µ
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useDocxEditor.ts     # ç¼–è¾‘å™¨çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ useFileTree.ts       # æ–‡ä»¶æ ‘çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ useConfirm.ts        # é€šç”¨ç¡®è®¤å¯¹è¯æ¡†
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ fileContentCache.ts  # æ–‡ä»¶å†…å®¹ç¼“å­˜
â””â”€â”€ WritingPage.tsx          # ä¸»å¸ƒå±€é¡µé¢
```

### 2.3 æ•°æ®æµè®¾è®¡

#### 2.3.1 å¯¹è¯æ•°æ®æµï¼ˆæ ‘å½¢ç»“æ„ï¼‰

é¡¹ç›®é‡‡ç”¨**æ ‘å½¢å¯¹è¯ç»“æ„**ï¼Œæ”¯æŒåˆ†æ”¯å¯¹è¯ï¼š

```typescript
// æ ¸å¿ƒæ•°æ®ç»“æ„
interface ConversationTree {
  flatMessages: Map<string, FlatMessage>  // æ‰å¹³åŒ–å­˜å‚¨
  rootNodes: MessageNode[]                 // æ ¹èŠ‚ç‚¹æ•°ç»„
  activePath: string[]                     // å½“å‰æ¿€æ´»è·¯å¾„
}

interface FlatMessage {
  id: string
  content: string
  role: 'user' | 'assistant' | 'system'
  parentId: string | null
  reasoning_content?: string  // æ€è€ƒè¿‡ç¨‹ï¼ˆæ”¯æŒOpenAI o1ç­‰æ¨¡å‹ï¼‰
  timestamp: number
}
```

**è®¾è®¡äº®ç‚¹**ï¼š
1. **æ‰å¹³åŒ–å­˜å‚¨ + æ ‘å½¢éå†**ï¼šé¿å…åµŒå¥—ç»“æ„çš„æ€§èƒ½é—®é¢˜
2. **activePathæœºåˆ¶**ï¼šæ¸…æ™°æ ‡è¯†å½“å‰å¯¹è¯è·¯å¾„
3. **åˆ†æ”¯ç®¡ç†**ï¼šæ”¯æŒä»ä»»æ„æ¶ˆæ¯ç‚¹é‡æ–°ç”Ÿæˆï¼Œå½¢æˆæ–°åˆ†æ”¯

#### 2.3.2 ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆContextEngineï¼‰

**è¿™æ˜¯é¡¹ç›®ä¸­æœ€ç²¾å¦™çš„è®¾è®¡ä¹‹ä¸€**ï¼š

```typescript
class ContextEngine {
  // 1. è·å–ä¸Šä¸‹æ–‡å…ƒæ•°æ®ï¼ˆUIå±•ç¤ºç”¨ï¼‰
  getContextMetadataFromTree(tree: ConversationTree, config: AIConfig): ContextMetadata
  
  // 2. æ„å»ºè¯·æ±‚æ¶ˆæ¯ï¼ˆæ ‡å‡†æµç¨‹ï¼‰
  buildRequestMessages(
    history: FlatMessage[],
    config: AIConfig,
    tempContent?: string,
    tempPlacement: TempContextPlacement = 'append'
  ): RequestMessage[]
  
  // 3. è‡ªå®šä¹‰å¤„ç†æµç¨‹ï¼ˆé«˜çº§ç”¨æ³•ï¼‰
  buildWithCustomPipeline(
    history: FlatMessage[],
    pipeline: (editor: MessageEditor) => MessageEditor
  ): RequestMessage[]
}
```

**æ“ä½œç¬¦æ¨¡å¼**ï¼š
```typescript
type MessageOperator = (editor: MessageEditor) => MessageEditor

// æ ‡å‡†å¤„ç†æµç¨‹
const applyStandardPipeline = (
  config: AIConfig,
  systemPrompt: string,
  tempContent?: string,
  tempPlacement?: TempContextPlacement
): MessageOperator => {
  return (editor) => editor
    .insertSystemMessage(systemPrompt)      // 1. æ’å…¥ç³»ç»Ÿæç¤º
    .applyPromptCards(tempPlacement)        // 2. åº”ç”¨æç¤ºè¯å¡ç‰‡
    .insertTempContext(tempContent, tempPlacement)  // 3. æ’å…¥ä¸´æ—¶ä¸Šä¸‹æ–‡
    .limit(config.historyLimit || 40)       // 4. é™åˆ¶å†å²æ•°é‡
}
```

### 2.4 çŠ¶æ€ç®¡ç†

é¡¹ç›®**æœªä½¿ç”¨å…¨å±€çŠ¶æ€ç®¡ç†åº“**ï¼ˆRedux/Zustandï¼‰ï¼Œè€Œæ˜¯é‡‡ç”¨ï¼š

1. **React Hooks + Context**ï¼šå±€éƒ¨çŠ¶æ€ç®¡ç†
2. **è‡ªå®šä¹‰Hookså°è£…**ï¼šå¦‚ `useConversationManager`ã€`useDocxEditor`
3. **Propsä¼ é€’**ï¼šç»„ä»¶é—´é€šä¿¡

**è¯„ä»·**ï¼šå¯¹äºä¸­ç­‰å¤æ‚åº¦çš„åº”ç”¨ï¼Œè¿™ç§æ–¹æ¡ˆè¶³å¤Ÿä¸”è½»é‡ã€‚ä½†éšç€åŠŸèƒ½å¢é•¿ï¼Œå¯èƒ½éœ€è¦å¼•å…¥çŠ¶æ€ç®¡ç†åº“ã€‚

---

## ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½æ·±åº¦è§£æ

### 3.1 AIå¯¹è¯ç³»ç»Ÿ

#### 3.1.1 å¤šæä¾›å•†æ”¯æŒ

é€šè¿‡**é€‚é…å™¨æ¨¡å¼**å®ç°å¯¹å¤šç§AI APIçš„æ”¯æŒï¼š

```typescript
// é€‚é…å™¨æ¥å£
interface ChatAdapter {
  callAPI(messages, config, abortSignal, ...): Promise<{content, reasoning_content}>
  buildRequestData(messages, config, ...): {url, headers, body}
}

// æ”¯æŒçš„æä¾›å•†
- OpenAIå…¼å®¹API (GPT-4, GPT-3.5, o1ç³»åˆ—)
- Google Gemini API
```

**é…ç½®çµæ´»æ€§**ï¼š
- æ”¯æŒè‡ªå®šä¹‰ `baseUrl`ï¼ˆå¯å¯¹æ¥æœ¬åœ°æ¨¡å‹ã€ç¬¬ä¸‰æ–¹ä»£ç†ï¼‰
- æ”¯æŒ `extraHeaders`ï¼ˆé¢å¤–è¯·æ±‚å¤´ï¼‰
- æ”¯æŒ `extraParams`ï¼ˆé¢å¤–è¯·æ±‚å‚æ•°ï¼‰
- **ä»£ç é…ç½®æ¨¡å¼**ï¼šå…è®¸é€šè¿‡JSONå®Œå…¨è‡ªå®šä¹‰è¯·æ±‚ä½“

#### 3.1.2 æµå¼å“åº”å¤„ç†

```typescript
// æ”¯æŒServer-Sent Events (SSE)æµå¼å“åº”
async callAPI(messages, config, abortSignal, onThinkingUpdate, onAnswerUpdate) {
  const response = await fetch(url, {body, signal: abortSignal})
  const reader = response.body.getReader()
  
  while (true) {
    const {done, value} = await reader.read()
    if (done) break
    
    const deltas = this.parseStreamChunk(value)
    for (const delta of deltas) {
      if (delta.reasoning_content) onThinkingUpdate(reasoning_content)
      if (delta.content) onAnswerUpdate(content)
    }
  }
}
```

**äº®ç‚¹**ï¼š
- å®æ—¶æ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹ï¼ˆ`reasoning_content`ï¼‰
- å®æ—¶æ˜¾ç¤ºå›ç­”å†…å®¹ï¼ˆ`content`ï¼‰
- æ”¯æŒè¯·æ±‚ä¸­æ–­å¹¶ä¿ç•™å·²ç”Ÿæˆå†…å®¹

#### 3.1.3 å¯¹è¯åˆ†æ”¯ç®¡ç†

```typescript
// åˆ†æ”¯å¯¼èˆª
const branchManager = useBranchManager({
  conversationTree,
  updateActivePath
})

// æ¯æ¡æ¶ˆæ¯æ˜¾ç¤ºåˆ†æ”¯ä¿¡æ¯
const branchNavigation = branchManager.getBranchNavigationForNode(nodeId)
// => { currentBranch: 2, totalBranches: 3, canNavigateLeft: true, ... }
```

**ç”¨æˆ·ä½“éªŒ**ï¼š
- åœ¨æ¶ˆæ¯æ°”æ³¡ä¸Šæ–¹æ˜¾ç¤º "2/3" æ ·å¼çš„åˆ†æ”¯æŒ‡ç¤ºå™¨
- ç‚¹å‡»å·¦å³ç®­å¤´åˆ‡æ¢åˆ†æ”¯
- ä»ä»»æ„æ¶ˆæ¯ç‚¹é‡æ–°ç”Ÿæˆï¼Œåˆ›å»ºæ–°åˆ†æ”¯

#### 3.1.4 ä¸Šä¸‹æ–‡å¯è§†åŒ–

```typescript
// ä¸Šä¸‹æ–‡ç»Ÿè®¡æ¡
const meta = contextEngine.getContextMetadataFromTree(conversationTree, config)
// => {
//   totalMessages: 20,
//   includedMessages: 10,  // è®¡å…¥ä¸Šä¸‹æ–‡
//   excludedMessages: 10,  // æœªè®¡å…¥ï¼ˆè¶…å‡ºhistoryLimitï¼‰
//   inclusionMap: Map<messageId, boolean>
// }
```

**UIå±•ç¤º**ï¼š
- é¡¶éƒ¨ç»Ÿè®¡æ¡ï¼š`è®¡å…¥ 10 | æœªè®¡å…¥ 10 (å†å²æ¶ˆæ¯å…± 20 æ¡ï¼Œä¿ç•™ä¸Šé™ 40)`
- æ¯æ¡æ¶ˆæ¯æ˜¾ç¤ºæ˜¯å¦è®¡å…¥ä¸Šä¸‹æ–‡çš„æ ‡è¯†
- æä¾›"æ¦‚æ‹¬"åŠŸèƒ½ï¼šåˆ›å»ºæ–°å¯¹è¯å¹¶æ€»ç»“å½“å‰ä¸Šä¸‹æ–‡

#### 3.1.5 æ¶ˆæ¯é¢„è§ˆåŠŸèƒ½

```typescript
// é¢„è§ˆæŒ‰é’® - æŸ¥çœ‹å³å°†å‘é€çš„è¯·æ±‚
const handlePreview = async () => {
  const {url, headers, body} = getPreviewData(history, config, extraContent)
  setPreviewData({url, headers, requestBody: body})
  setShowPreviewDialog(true)
}
```

**ä»·å€¼**ï¼šå¸®åŠ©ç”¨æˆ·ç†è§£AIå®é™…æ”¶åˆ°çš„ä¸Šä¸‹æ–‡ï¼Œä¾¿äºè°ƒè¯•å’Œä¼˜åŒ–æç¤ºè¯ã€‚

### 3.2 æ–‡æ¡£ç¼–è¾‘ç³»ç»Ÿ

#### 3.2.1 DOCXç¼–è¾‘å™¨

åŸºäº `contentEditable` å®ç°çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼š

```tsx
<div 
  ref={editorRef}
  contentEditable={!readOnly}
  onInput={handleInput}
  className="content-theme"
/>
```

**æ”¯æŒæ ¼å¼**ï¼š
- `.docx` - é€šè¿‡ `mammoth` è½¬æ¢ä¸ºHTMLï¼Œç¼–è¾‘åé€šè¿‡ `docx` åº“å›å†™
- `.doc` - åŒä¸Š
- `.txt` - çº¯æ–‡æœ¬
- `.md` - Markdownï¼ˆæ¸²æŸ“ä¸ºHTMLç¼–è¾‘ï¼‰

**åŠŸèƒ½**ï¼š
- å®æ—¶å­—æ•°ç»Ÿè®¡ï¼ˆä¸­è‹±æ–‡åˆ†åˆ«ç»Ÿè®¡ï¼‰
- Ctrl+S å¿«æ·é”®ä¿å­˜
- æœªä¿å­˜æç¤º
- å…³é—­æ—¶è‡ªåŠ¨ä¿å­˜ç¡®è®¤

#### 3.2.2 æ–‡ä»¶ç®¡ç†

**æ–‡ä»¶æ ‘ç»„ä»¶**ç‰¹æ€§ï¼š
- é€’å½’æ¸²æŸ“ç›®å½•ç»“æ„
- æ”¯æŒå†…è”é‡å‘½åï¼ˆåŒå‡»æˆ–F2ï¼‰
- å³é”®èœå•ï¼šæ–°å»ºæ–‡ä»¶/æ–‡ä»¶å¤¹ã€é‡å‘½åã€åˆ é™¤
- æ–‡ä»¶æ‹–æ‹½é€‰æ‹©ï¼ˆè®¡åˆ’æ”¯æŒï¼‰

**å¤šæ–‡ä»¶é€‰æ‹©ä½œä¸ºä¸Šä¸‹æ–‡**ï¼š
```typescript
// é€‰ä¸­æ–‡ä»¶ä½œä¸ºAIä¸Šä¸‹æ–‡
const [selectedFiles, setSelectedFiles] = useState<Set<string>>(new Set())

// ç”Ÿæˆé¢å¤–ä¸Šä¸‹æ–‡
const getAdditionalContent = async (): Promise<string> => {
  const filePaths = Array.from(selectedFiles)
  const contents = await readMultipleFiles(filePaths)
  return contents.map(({path, content}) => 
    formatFileContent(path, content)
  ).join('\n\n')
}
```

**äº®ç‚¹**ï¼š
- å»¶è¿ŸåŠ è½½ï¼šä»…åœ¨å‘é€æ¶ˆæ¯æ—¶è¯»å–æ–‡ä»¶å†…å®¹
- ä¼˜å…ˆä½¿ç”¨ç¼–è¾‘å™¨ä¸­çš„æœªä¿å­˜å†…å®¹ï¼ˆè€Œéç£ç›˜å†…å®¹ï¼‰
- æ”¯æŒå›¾ç‰‡æ–‡ä»¶ï¼ˆä»¥base64å½¢å¼å‘é€ï¼‰

#### 3.2.3 æ–‡æ¡£æ ¼å¼è½¬æ¢

**Electronä¸»è¿›ç¨‹å¤„ç†**ï¼š
```javascript
class DocxHandler {
  async convertToHtml(docxPath) {
    const buffer = await fs.readFile(docxPath)
    const result = await mammoth.convertToHtml({buffer})
    return result.value
  }
  
  async convertFromHtml(htmlContent, outputPath) {
    const doc = new docx.Document({
      sections: [/* ä»HTMLè§£æ */]
    })
    const buffer = await docx.Packer.toBuffer(doc)
    await fs.writeFile(outputPath, buffer)
  }
}
```

### 3.3 æç¤ºè¯ç®¡ç†ç³»ç»Ÿ

#### 3.3.1 æç¤ºè¯å¡ç‰‡æœºåˆ¶

**ç‹¬ç«‹çª—å£ç®¡ç†**ï¼š
```javascript
// æ‰“å¼€æç¤ºè¯çª—å£ï¼ˆç‹¬ç«‹äºä¸»çª—å£ï¼‰
windowManager.createPromptTemplateWindow()
// åŠ è½½ ?page=prompt å‚æ•°çš„é¡µé¢
```

**å¡ç‰‡æ•°æ®ç»“æ„**ï¼š
```typescript
interface PromptCard {
  id: string
  title: string
  content: string
  placement: 'system' | 'after_system' | 'user_end'
  enabled: boolean
  order: number
  createdAt: number
  updatedAt: number
}
```

#### 3.3.2 æ’å…¥ä½ç½®ç­–ç•¥

| placement | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|-----------|------|---------|
| `system` | è¿½åŠ åˆ°ç°æœ‰systemæ¶ˆæ¯ä¸­ | è§’è‰²è®¾å®šã€é€šç”¨è§„åˆ™ |
| `after_system` | åœ¨æ‰€æœ‰systemæ¶ˆæ¯ä¹‹åç‹¬ç«‹æ’å…¥ | ç‹¬ç«‹çš„æŒ‡ä»¤ã€ç‰¹æ®Šè¦æ±‚ |
| `user_end` | è¿½åŠ åˆ°æœ€åä¸€æ¡useræ¶ˆæ¯æœ«å°¾ | æ ¼å¼è¦æ±‚ã€è¾“å‡ºé™åˆ¶ |

**å¤šå¡ç‰‡å åŠ **ï¼š
```typescript
// æŒ‰ order æ’åºåä¾æ¬¡åº”ç”¨
const enabledCards = promptCardManager.getAllCards()
  .filter(card => card.enabled)
  .sort((a, b) => a.order - b.order)

for (const card of enabledCards) {
  applyCard(card, messages)
}
```

#### 3.3.3 ä¸ContextEngineé›†æˆ

```typescript
// MessageEditorä¸­çš„åº”ç”¨
editor.applyPromptCards(tempPlacement: TempContextPlacement) {
  const cards = promptCardManager.getAllCards()
    .filter(c => c.enabled)
    .sort((a, b) => a.order - b.order)
  
  for (const card of cards) {
    if (card.placement === 'system') {
      this.appendToLastSystemMessage(card.content)
    } else if (card.placement === 'after_system') {
      this.insertAfterSystem({role: 'user', content: card.content})
    } else if (card.placement === 'user_end') {
      this.appendToLastUserMessage(card.content)
    }
  }
  
  return this
}
```

### 3.4 æ•°æ®æŒä¹…åŒ–

#### 3.4.1 å­˜å‚¨ç­–ç•¥

**Electronç«¯ï¼ˆä¸»è¿›ç¨‹ï¼‰**ï¼š
```javascript
// ä¼˜å…ˆä½¿ç”¨å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•ï¼ˆä¾¿æºæ¨¡å¼ï¼‰
const executableDir = path.dirname(process.execPath)
const storageDir = path.join(executableDir, 'app_data')

// å›é€€åˆ°ç”¨æˆ·æ•°æ®ç›®å½•
const fallbackDir = app.getPath('userData')
```

**æ–‡ä»¶ç»“æ„**ï¼š
```
app_data/
â”œâ”€â”€ ai_config.json              # AIé…ç½®
â”œâ”€â”€ prompt_cards.json           # æç¤ºè¯å¡ç‰‡
â”œâ”€â”€ writing_conversation_history.json  # å¯¹è¯å†å²
â””â”€â”€ active_conversation_id.json # å½“å‰æ¿€æ´»çš„å¯¹è¯ID
```

#### 3.4.2 åŒæ­¥/å¼‚æ­¥API

```typescript
// å¼‚æ­¥APIï¼ˆæ¨èï¼‰
await storage.set('ai_config', config)
const config = await storage.get('ai_config')

// åŒæ­¥APIï¼ˆåˆå§‹åŒ–åœºæ™¯ï¼‰
storage.setSync('ai_config', config)
const config = storage.getSync('ai_config')
```

### 3.5 å¸ƒå±€ç³»ç»Ÿ

ä½¿ç”¨ `react-resizable-panels` å®ç°å¯è°ƒæ•´å¤§å°çš„ä¸‰æ å¸ƒå±€ï¼š

```tsx
<PanelGroup direction="horizontal" autoSaveId="writing-page-panels">
  <Panel defaultSize={15}>
    <FileTreePanel />  {/* å·¦ä¾§ï¼šæ–‡ä»¶ç®¡ç† */}
  </Panel>
  <PanelResizeHandle />
  <Panel defaultSize={50}>
    <DocxEditor />     {/* ä¸­é—´ï¼šæ–‡æ¡£ç¼–è¾‘ */}
  </Panel>
  <PanelResizeHandle />
  <Panel defaultSize={35}>
    <ChatPanel />      {/* å³ä¾§ï¼šAIåŠ©æ‰‹ */}
  </Panel>
</PanelGroup>
```

**ä¼˜åŠ¿**ï¼š
- è‡ªåŠ¨ä¿å­˜å¸ƒå±€æ¯”ä¾‹ï¼ˆåŸºäº `autoSaveId`ï¼‰
- æµç•…çš„æ‹–æ‹½ä½“éªŒ
- æœ€å°/æœ€å¤§å°ºå¯¸é™åˆ¶

---

## å››ã€é¡¹ç›®äº®ç‚¹

### 4.1 æ¶æ„è®¾è®¡äº®ç‚¹

#### 1. **ContextEngine - ä¸Šä¸‹æ–‡å¼•æ“è®¾è®¡**

è¿™æ˜¯é¡¹ç›®ä¸­æœ€ä¼˜ç§€çš„è®¾è®¡ï¼Œä½“ç°äº†**å•ä¸€èŒè´£ã€å¯æ‰©å±•ã€å¯æµ‹è¯•**çš„åŸåˆ™ã€‚

**æ ¸å¿ƒç†å¿µ**ï¼š
- å°†æ¶ˆæ¯å¤„ç†é€»è¾‘ä»ä¸šåŠ¡ä»£ç ä¸­è§£è€¦
- æä¾›çµæ´»çš„æ“ä½œç¬¦æ¨¡å¼ï¼ˆOperator Patternï¼‰
- æ”¯æŒè‡ªå®šä¹‰å¤„ç†æµç¨‹

**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// æ ‡å‡†ç”¨æ³•
const messages = contextEngine.buildRequestMessages(history, config, tempContent)

// é«˜çº§ç”¨æ³•ï¼šè‡ªå®šä¹‰å¤„ç†æµç¨‹
const messages = contextEngine.buildWithCustomPipeline(history, (editor) =>
  editor
    .insertSystemMessage('You are a translator')
    .removeWhere(msg => msg.content.length > 1000)
    .limit(5)
)

// æ‰©å±•ç”¨æ³•ï¼šæ³¨å†Œå…¨å±€æ“ä½œç¬¦
const unregister = contextEngine.registerOperator((editor) =>
  editor.transform(msg => ({...msg, content: msg.content.toUpperCase()}))
)
```

**ä»·å€¼**ï¼š
- æœªæ¥å¯è½»æ¾æ”¯æŒæ›´å¤æ‚çš„ä¸Šä¸‹æ–‡ç­–ç•¥ï¼ˆå¦‚æ™ºèƒ½å‹ç¼©ã€åŠ¨æ€æ‘˜è¦ï¼‰
- æµ‹è¯•å‹å¥½ï¼ˆçº¯å‡½æ•°è®¾è®¡ï¼‰
- ä¸ä¾èµ–å…·ä½“çš„UIæˆ–APIå®ç°

#### 2. **é€‚é…å™¨æ¨¡å¼ - å¤šAIæä¾›å•†æ”¯æŒ**

é€šè¿‡ç»Ÿä¸€çš„ `ChatAdapter` æ¥å£ï¼Œå®ç°å¯¹ä¸åŒAI APIçš„é€‚é…ï¼š

```typescript
interface ChatAdapter {
  callAPI(...): Promise<{content, reasoning_content}>
  buildRequestData(...): {url, headers, body}
}

class OpenAIAdapter implements ChatAdapter { /* ... */ }
class GeminiAdapter implements ChatAdapter { /* ... */ }
```

**å¥½å¤„**ï¼š
- æ·»åŠ æ–°æä¾›å•†åªéœ€å®ç°ä¸€ä¸ªé€‚é…å™¨ç±»
- ä¸šåŠ¡ä»£ç æ— éœ€å…³å¿ƒå…·ä½“çš„APIå·®å¼‚
- ä¾¿äºå•ç‹¬æµ‹è¯•æ¯ä¸ªé€‚é…å™¨

#### 3. **æ ‘å½¢å¯¹è¯ç»“æ„ + åˆ†æ”¯ç®¡ç†**

åŒºåˆ«äºç®€å•çš„çº¿æ€§å¯¹è¯å†å²ï¼Œé¡¹ç›®å®ç°äº†å®Œæ•´çš„æ ‘å½¢ç»“æ„ï¼š

```
Root
â”œâ”€ User: "å†™ä¸€é¦–è¯—"
â”‚  â”œâ”€ Assistant: "æ˜¥æ™“..."  [åˆ†æ”¯1]
â”‚  â”œâ”€ Assistant: "é™å¤œæ€..." [åˆ†æ”¯2]
â”‚  â””â”€ Assistant: "ç™»é¹³é›€æ¥¼..." [åˆ†æ”¯3]
â”‚     â””â”€ User: "ç»§ç»­å†™"
â”‚        â””â”€ Assistant: "..."
```

**ä¼˜åŠ¿**ï¼š
- æ”¯æŒAIå›ç­”çš„å¤šæ¬¡é‡æ–°ç”Ÿæˆ
- ä¿ç•™æ‰€æœ‰å†å²åˆ†æ”¯ï¼Œå¯éšæ—¶åˆ‡æ¢
- æ”¯æŒä»ä»»æ„èŠ‚ç‚¹ç»§ç»­å¯¹è¯

**å®ç°ç»†èŠ‚**ï¼š
```typescript
// æ‰å¹³åŒ–å­˜å‚¨é¿å…æ·±å±‚åµŒå¥—
const flatMessages = new Map<string, FlatMessage>()

// å½“å‰æ¿€æ´»è·¯å¾„ï¼ˆIDæ•°ç»„ï¼‰
const activePath = ['id1', 'id2', 'id3']

// è·å–åˆ†æ”¯ä¿¡æ¯
const siblings = getSiblings(messageId, flatMessages)
const currentIndex = siblings.indexOf(messageId)
// => "2/3" è¡¨ç¤ºå½“å‰åœ¨ç¬¬2ä¸ªåˆ†æ”¯ï¼Œå…±3ä¸ªåˆ†æ”¯
```

#### 4. **æ¨¡å—åŒ–çš„Electronæ¶æ„**

ä¸»è¿›ç¨‹é‡‡ç”¨æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ï¼Œæ¯ä¸ªç®¡ç†å™¨ä¸“æ³¨å•ä¸€èŒè´£ï¼š

```javascript
class Application {
  constructor() {
    this.windowManager = new WindowManager()
    this.storageManager = new StorageManager()
    this.fileSystemManager = new FileSystemManager(mainWindow)
    this.contextMenuManager = new GlobalContextMenuManager(mainWindow)
    this.docxHandler = new DocxHandler()
  }
  
  _registerIpcHandlers() {
    // ç»Ÿä¸€æ³¨å†Œæ‰€æœ‰IPCå¤„ç†å™¨
    this.storageManager.registerIpcHandlers(ipcMain)
    this.fileSystemManager.registerIpcHandlers(ipcMain)
    this.docxHandler.registerIpcHandlers(ipcMain)
  }
}
```

**ä¼˜åŠ¿**ï¼š
- æ˜“äºç»´æŠ¤å’Œæµ‹è¯•
- æ–°å¢åŠŸèƒ½æ—¶ä¸ä¼šå½±å“å…¶ä»–æ¨¡å—
- ç¬¦åˆSOLIDåŸåˆ™

### 4.2 åŠŸèƒ½è®¾è®¡äº®ç‚¹

#### 1. **æ–‡ä»¶å†…å®¹ä½œä¸ºä¸Šä¸‹æ–‡**

å…è®¸ç”¨æˆ·é€‰æ‹©å¤šä¸ªæ–‡ä»¶ï¼ŒAIå¯ä»¥åŸºäºæ–‡ä»¶å†…å®¹å›ç­”é—®é¢˜ï¼š

```typescript
// ä½¿ç”¨åœºæ™¯ï¼š
// 1. é€‰ä¸­é¡¹ç›®ä¸­çš„å¤šä¸ªä»£ç æ–‡ä»¶
// 2. è¯¢é—®AIï¼š"è¿™äº›æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ"
// 3. AIåŸºäºæ‰€æœ‰æ–‡ä»¶å†…å®¹è¿›è¡Œåˆ†æ

const getAdditionalContent = async () => {
  const contents = await readMultipleFiles(selectedFiles)
  return formatAsContext(contents)
}
```

**æ ¼å¼åŒ–è¾“å‡º**ï¼š
```
--- æ–‡ä»¶: src/App.tsx ---
[æ–‡ä»¶å†…å®¹]

--- æ–‡ä»¶: src/utils.ts ---
[æ–‡ä»¶å†…å®¹]
```

**å›¾ç‰‡æ”¯æŒ**ï¼š
```typescript
if (fileType === 'image') {
  const base64 = await readFileAsBase64(filePath)
  return `![${filename}](data:image/png;base64,${base64})`
}
```

#### 2. **æ¶ˆæ¯é¢„è§ˆåŠŸèƒ½**

å…è®¸ç”¨æˆ·åœ¨å‘é€å‰æŸ¥çœ‹å®Œæ•´çš„è¯·æ±‚æ•°æ®ï¼š

```tsx
<MessagePreviewDialog
  url={previewData.url}
  headers={previewData.headers}
  requestBody={previewData.requestBody}
/>
```

**æ˜¾ç¤ºå†…å®¹**ï¼š
- APIç«¯ç‚¹
- è¯·æ±‚å¤´ï¼ˆéšè—æ•æ„Ÿä¿¡æ¯ï¼‰
- å®Œæ•´çš„è¯·æ±‚ä½“ï¼ˆåŒ…æ‹¬æ‰€æœ‰ä¸Šä¸‹æ–‡ã€æç¤ºè¯ï¼‰

**ä»·å€¼**ï¼š
- å¸®åŠ©ç†è§£AIçš„"è§†è§’"
- è°ƒè¯•å¤æ‚çš„æç¤ºè¯é…ç½®
- å­¦ä¹ APIè°ƒç”¨æ–¹å¼

#### 3. **æ™ºèƒ½çš„æœªä¿å­˜æç¤º**

ç¼–è¾‘å™¨å’Œå¯¹è¯éƒ½æœ‰å®Œå–„çš„æœªä¿å­˜æç¤ºæœºåˆ¶ï¼š

```typescript
// æ–‡æ¡£ç¼–è¾‘å™¨
if (openFile?.isModified) {
  const shouldSave = await confirm({
    title: 'æœªä¿å­˜çš„æ›´æ”¹',
    message: `æ–‡ä»¶"${openFile.name}"æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œæ˜¯å¦ä¿å­˜ï¼Ÿ`
  })
  
  if (shouldSave) await saveFile()
}
```

**è§¦å‘æ—¶æœº**ï¼š
- å…³é—­æ–‡ä»¶æ—¶
- æ‰“å¼€æ–°æ–‡ä»¶æ—¶
- å…³é—­åº”ç”¨æ—¶ï¼ˆæœªæ¥å¯å®ç°ï¼‰

#### 4. **ä¸Šä¸‹æ–‡å¯è§†åŒ–**

åœ¨å¯¹è¯ç•Œé¢é¡¶éƒ¨æ˜¾ç¤ºä¸Šä¸‹æ–‡ç»Ÿè®¡ï¼š

```tsx
<div className="context-stats">
  <span>è®¡å…¥ {meta.includedMessages}</span>
  {meta.excludedMessages > 0 && (
    <span>æœªè®¡å…¥ {meta.excludedMessages}</span>
  )}
  <span>(å†å²æ¶ˆæ¯å…± {meta.totalMessages} æ¡ï¼Œä¿ç•™ä¸Šé™ {config.historyLimit || 'âˆ'})</span>
  <button onClick={handleSummarize}>æ¦‚æ‹¬</button>
</div>
```

**æ¯æ¡æ¶ˆæ¯çš„æ ‡è¯†**ï¼š
- è®¡å…¥ä¸Šä¸‹æ–‡ï¼šæ­£å¸¸æ˜¾ç¤º
- æœªè®¡å…¥ï¼šç°è‰²æ˜¾ç¤º + æç¤ºæ ‡ç­¾

**æ¦‚æ‹¬åŠŸèƒ½**ï¼š
- ç‚¹å‡»"æ¦‚æ‹¬"æŒ‰é’®
- åˆ›å»ºæ–°å¯¹è¯
- ä½¿ç”¨ç‰¹æ®Šç³»ç»Ÿæç¤ºï¼š`è¯·ç”¨ç®€æ´çš„è¯­è¨€æ¦‚æ‹¬ä»¥ä¸‹å†…å®¹...`
- å°†å½“å‰ä¸Šä¸‹æ–‡å’Œå¯¹è¯å†å²ä½œä¸ºè¾“å…¥
- å¾—åˆ°ç²¾ç®€çš„æ‘˜è¦ï¼Œå¯ç»§ç»­åŸºäºæ‘˜è¦å¯¹è¯

#### 5. **ä»£ç é…ç½®æ¨¡å¼**

å…è®¸é«˜çº§ç”¨æˆ·é€šè¿‡JSONå®Œå…¨è‡ªå®šä¹‰APIè¯·æ±‚ï¼š

```typescript
// åœ¨APIé…ç½®ä¸­å¯ç”¨"ä»£ç é…ç½®æ¨¡å¼"
{
  "enableCodeConfig": true,
  "codeConfigJson": `{
    "temperature": 0.7,
    "top_p": 0.9,
    "frequency_penalty": 0.5,
    "presence_penalty": 0.5,
    "stop": ["Human:", "AI:"]
  }`
}
```

**åˆå¹¶ç­–ç•¥**ï¼š
- ç”¨æˆ·æä¾›çš„JSONä¸åŸºç¡€é…ç½®åˆå¹¶
- `messages` å­—æ®µå§‹ç»ˆä½¿ç”¨ç³»ç»Ÿæ„å»ºçš„ï¼ˆä¸å…è®¸è¦†ç›–ï¼‰
- å…¶ä»–å­—æ®µç”¨æˆ·ä¼˜å…ˆ

**ä½¿ç”¨åœºæ™¯**ï¼š
- è°ƒè¯•ç‰¹å®šå‚æ•°
- ä½¿ç”¨æä¾›å•†ç‰¹æœ‰çš„å‚æ•°
- å¿«é€Ÿå®éªŒä¸åŒé…ç½®

#### 6. **æµå¼æ€è€ƒè¿‡ç¨‹æ˜¾ç¤º**

æ”¯æŒ OpenAI o1 ç­‰æ¨¡å‹çš„ `reasoning_content`ï¼š

```typescript
// æµå¼æ›´æ–°
onThinkingUpdate(thinking: string) {
  setCurrentThinking(thinking)  // å®æ—¶æ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹
}

onAnswerUpdate(answer: string) {
  setCurrentAnswer(answer)      // å®æ—¶æ˜¾ç¤ºå›ç­”å†…å®¹
}
```

**UIå±•ç¤º**ï¼š
```
[æ€è€ƒè¿‡ç¨‹]
ğŸ¤” æ­£åœ¨åˆ†æé—®é¢˜...
è®©æˆ‘å…ˆç†è§£ä¸€ä¸‹ç”¨æˆ·çš„éœ€æ±‚...

[å›ç­”å†…å®¹]
æ ¹æ®æ‚¨çš„é—®é¢˜...
```

### 4.3 å·¥ç¨‹åŒ–äº®ç‚¹

#### 1. **TypeScriptç±»å‹å®‰å…¨**

é¡¹ç›®å…¨é¢ä½¿ç”¨TypeScriptï¼Œç±»å‹è¦†ç›–ç‡é«˜ï¼š

```typescript
// å®Œå–„çš„ç±»å‹å®šä¹‰
interface FlatMessage {
  id: string
  content: string
  role: 'user' | 'assistant' | 'system'
  parentId: string | null
  reasoning_content?: string
  timestamp: number
}

// ä¸¥æ ¼çš„å‡½æ•°ç­¾å
function buildRequestMessages(
  history: FlatMessage[],
  config: AIConfig,
  tempContent?: string,
  tempPlacement?: TempContextPlacement
): RequestMessage[]
```

#### 2. **Viteæ„å»ºä¼˜åŒ–**

```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: (id) => {
          // ä»£ç åˆ†å‰²ç­–ç•¥
          if (id.includes('react')) return 'react'
          if (id.includes('markdown')) return 'markdown'
          if (id.includes('syntax-highlighter')) return 'syntax'
          return 'vendor'
        }
      }
    }
  },
  esbuild: isProd ? {
    drop: ['console', 'debugger']  // ç”Ÿäº§ç¯å¢ƒç§»é™¤è°ƒè¯•ä»£ç 
  } : undefined
})
```

**ä¼˜åŠ¿**ï¼š
- é¦–å±åŠ è½½å¿«
- æŒ‰éœ€åŠ è½½å¤§ä½“ç§¯ä¾èµ–
- ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨ä¼˜åŒ–

#### 3. **å¼€å‘ä½“éªŒä¼˜åŒ–**

```json
// package.json
{
  "scripts": {
    "dev": "concurrently \"vite\" \"wait-on http://localhost:5173 && electron .\"",
    "build": "tsc -b && vite build",
    "pack": "npm run build && electron-builder --win"
  }
}
```

**ç‰¹æ€§**ï¼š
- çƒ­é‡è½½ï¼ˆVite HMRï¼‰
- ä¸»è¿›ç¨‹è‡ªåŠ¨é‡å¯
- TypeScriptç±»å‹æ£€æŸ¥
- ESLintä»£ç æ£€æŸ¥

#### 4. **Electronå®‰å…¨å®è·µ**

```javascript
// æ­£ç¡®çš„å®‰å…¨é…ç½®
{
  webPreferences: {
    nodeIntegration: false,        // ç¦ç”¨Nodeé›†æˆ
    contextIsolation: true,        // å¯ç”¨ä¸Šä¸‹æ–‡éš”ç¦»
    enableRemoteModule: false,     // ç¦ç”¨remoteæ¨¡å—
    preload: path.join(__dirname, 'preload.js')
  }
}

// é˜»æ­¢å¯¼èˆªåˆ°å¤–éƒ¨URL
mainWindow.webContents.on('will-navigate', (event, url) => {
  const parsedUrl = new URL(url)
  if (parsedUrl.protocol !== 'file:') {
    event.preventDefault()
  }
})
```

#### 5. **ä¾¿æºæ¨¡å¼æ”¯æŒ**

```javascript
// ä¼˜å…ˆä½¿ç”¨å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•å­˜å‚¨æ•°æ®
const executableDir = path.dirname(process.execPath)
const storageDir = path.join(executableDir, 'app_data')

// å®ç°ä¾¿æºç‰ˆï¼ˆæ— éœ€å®‰è£…ï¼Œå¯æ”¾åœ¨Uç›˜ï¼‰
```

---

## äº”ã€é¡¹ç›®ä¸è¶³

### 5.1 æ¶æ„å±‚é¢

#### 1. **ç¼ºä¹å…¨å±€çŠ¶æ€ç®¡ç†**

**é—®é¢˜**ï¼š
- å¤šä¸ªç»„ä»¶é€šè¿‡Propsä¼ é€’å…±äº«çŠ¶æ€ï¼ˆå¦‚ `config`ã€`selectedFiles`ï¼‰
- æ·±å±‚ç»„ä»¶éœ€è¦å±‚å±‚ä¼ é€’Props
- çŠ¶æ€æ›´æ–°é€»è¾‘åˆ†æ•£åœ¨å„ç»„ä»¶

**å½±å“**ï¼š
```tsx
// å½“å‰å®ç°ï¼šProps Drilling
<WritingPage config={config} onConfigChange={setConfig}>
  <FileTreePanel selectedFiles={selectedFiles} onFileSelect={handleFileSelect}>
    <FileTreeNode selectedFiles={selectedFiles} ... />
  </FileTreePanel>
  <ChatPanel config={config} onConfigChange={handleConfigChange} />
</WritingPage>
```

**å»ºè®®**ï¼š
- å¼•å…¥è½»é‡çº§çŠ¶æ€ç®¡ç†ï¼šZustand æˆ– Jotai
- å…¨å±€çŠ¶æ€ï¼š`config`ã€`selectedFiles`ã€`currentConversation`
- æœ¬åœ°çŠ¶æ€ï¼šUIäº¤äº’çŠ¶æ€

**ç¤ºä¾‹**ï¼š
```typescript
// ä½¿ç”¨Zustand
const useAppStore = create<AppState>((set) => ({
  config: DEFAULT_CONFIG,
  selectedFiles: new Set(),
  setConfig: (config) => set({ config }),
  toggleFileSelection: (filePath) => set((state) => {
    const newSet = new Set(state.selectedFiles)
    newSet.has(filePath) ? newSet.delete(filePath) : newSet.add(filePath)
    return { selectedFiles: newSet }
  })
}))

// ä»»æ„ç»„ä»¶ç›´æ¥è®¿é—®
const config = useAppStore(state => state.config)
const setConfig = useAppStore(state => state.setConfig)
```

#### 2. **ç¼ºä¹ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶**

**é—®é¢˜**ï¼š
- é”™è¯¯å¤„ç†åˆ†æ•£åœ¨å„ä¸ªasyncå‡½æ•°çš„try-catchä¸­
- é”™è¯¯ä¿¡æ¯æ ¼å¼ä¸ç»Ÿä¸€
- ç¼ºä¹å…¨å±€é”™è¯¯è¾¹ç•Œï¼ˆError Boundaryï¼‰

**ç¤ºä¾‹**ï¼š
```typescript
// å½“å‰å®ç°
try {
  const result = await someAsyncOperation()
} catch (error: any) {
  alert(`æ“ä½œå¤±è´¥: ${error.message}`)  // ç®€é™‹çš„é”™è¯¯æç¤º
}
```

**å»ºè®®**ï¼š
```typescript
// 1. ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å‡½æ•°
function handleError(error: Error, context: string) {
  console.error(`[${context}]`, error)
  toast.error(`${context}å¤±è´¥ï¼š${error.message}`)
  // å‘é€åˆ°é”™è¯¯è¿½è¸ªæœåŠ¡ï¼ˆå¦‚Sentryï¼‰
}

// 2. React Error Boundary
class ErrorBoundary extends React.Component {
  componentDidCatch(error, errorInfo) {
    handleError(error, 'Reactç»„ä»¶æ¸²æŸ“')
  }
}

// 3. å…¨å±€æœªæ•è·å¼‚å¸¸å¤„ç†
window.addEventListener('unhandledrejection', (event) => {
  handleError(event.reason, 'æœªå¤„ç†çš„Promiseæ‹’ç»')
})
```

#### 3. **æ–‡æ¡£ç¼–è¾‘å™¨æ¶æ„ç®€é™‹**

**é—®é¢˜**ï¼š
- ä½¿ç”¨åŸç”Ÿ `contentEditable`ï¼ŒåŠŸèƒ½æœ‰é™
- DOCXè½¬HTMLè½¬DOCXçš„å¾€è¿”è½¬æ¢å¯èƒ½ä¸¢å¤±æ ¼å¼
- ç¼ºä¹æ’¤é”€/é‡åšæ ˆ
- ä¸æ”¯æŒåä½œç¼–è¾‘

**å½“å‰å®ç°**ï¼š
```tsx
<div 
  contentEditable={true}
  onInput={(e) => onChange(e.currentTarget.innerHTML)}
/>
```

**å»ºè®®**ï¼š
- å¼•å…¥æˆç†Ÿçš„ç¼–è¾‘å™¨æ¡†æ¶ï¼š
  - **Lexical** (Facebookå¼€æºï¼Œè½»é‡çº§)
  - **ProseMirror** (åŠŸèƒ½å¼ºå¤§ï¼Œå­¦ä¹ æ›²çº¿é™¡)
  - **Slate** (Reactå‹å¥½)
- æˆ–ä¸“æ³¨çº¯Markdownç¼–è¾‘ï¼ˆä½¿ç”¨CodeMirror/Monacoï¼‰

#### 4. **ç¼ºä¹æ’ä»¶ç³»ç»Ÿ**

**é—®é¢˜**ï¼š
- æ‰©å±•åŠŸèƒ½éœ€è¦ä¿®æ”¹æºä»£ç 
- ç”¨æˆ·æ— æ³•è‡ªå®šä¹‰åŠŸèƒ½

**å»ºè®®**ï¼š
- è®¾è®¡æ’ä»¶APIï¼š
  ```typescript
  interface Plugin {
    name: string
    version: string
    onLoad(context: PluginContext): void
    onUnload(): void
  }
  
  // æ’ä»¶å¯ä»¥ï¼š
  // - æ³¨å†Œè‡ªå®šä¹‰å³é”®èœå•é¡¹
  // - æ·»åŠ å·¥å…·æ æŒ‰é’®
  // - æ³¨å†Œæ–‡ä»¶ç±»å‹å¤„ç†å™¨
  // - æ³¨å†ŒAIæ¶ˆæ¯æ“ä½œç¬¦
  ```

### 5.2 åŠŸèƒ½å±‚é¢

#### 1. **æ–‡ä»¶ç›‘å¬ç¼ºå¤±**

**é—®é¢˜**ï¼š
- å¤–éƒ¨ä¿®æ”¹æ–‡ä»¶æ—¶ï¼Œåº”ç”¨å†…ä¸ä¼šè‡ªåŠ¨åˆ·æ–°
- å¯èƒ½å¯¼è‡´ç¼–è¾‘å†²çª

**å»ºè®®**ï¼š
```javascript
// Electronä¸»è¿›ç¨‹
const chokidar = require('chokidar')

const watcher = chokidar.watch(workspacePath, {
  ignored: /(^|[\/\\])\../,  // å¿½ç•¥éšè—æ–‡ä»¶
  persistent: true
})

watcher.on('change', (path) => {
  mainWindow.webContents.send('file-changed', path)
})
```

#### 2. **æœç´¢åŠŸèƒ½ç¼ºå¤±**

**é—®é¢˜**ï¼š
- æ— æ³•åœ¨æ–‡ä»¶æ ‘ä¸­æœç´¢æ–‡ä»¶å
- æ— æ³•å…¨æ–‡æœç´¢æ–‡ä»¶å†…å®¹
- æ— æ³•æœç´¢å¯¹è¯å†å²

**å»ºè®®**ï¼š
- æ–‡ä»¶åæœç´¢ï¼šå‰ç«¯å®ç°ï¼Œæ¨¡ç³ŠåŒ¹é…
- å…¨æ–‡æœç´¢ï¼šä½¿ç”¨ `ripgrep` æˆ– `fzf`
- å¯¹è¯å†å²æœç´¢ï¼šåŸºäºå…³é”®è¯ã€æ—¥æœŸã€AIæ¨¡å‹ç­‰ç»´åº¦

#### 3. **å¿«æ·é”®ç³»ç»Ÿä¸å®Œå–„**

**é—®é¢˜**ï¼š
- ä»…æ”¯æŒ Ctrl+S ä¿å­˜
- ç¼ºä¹å…¶ä»–å¸¸ç”¨å¿«æ·é”®

**å»ºè®®**ï¼š
```typescript
// ä½¿ç”¨ mousetrap æˆ– react-hotkeys-hook
useHotkeys('ctrl+n', () => createNewFile())
useHotkeys('ctrl+f', () => openSearch())
useHotkeys('ctrl+b', () => toggleSidebar())
useHotkeys('ctrl+shift+p', () => openCommandPalette())
```

#### 4. **AIåŠŸèƒ½å•ä¸€**

**é—®é¢˜**ï¼š
- ä»…æ”¯æŒå¯¹è¯ï¼Œç¼ºä¹å…¶ä»–AIèƒ½åŠ›

**å»ºè®®æ‰©å±•**ï¼š
- **AIå†™ä½œåŠ©æ‰‹**ï¼šç»­å†™ã€æ‰©å†™ã€æ”¹å†™ã€æ€»ç»“
- **AIç¿»è¯‘**ï¼šé€‰ä¸­æ–‡æœ¬å¿«é€Ÿç¿»è¯‘
- **AIæ¶¦è‰²**ï¼šè¯­æ³•æ£€æŸ¥ã€é£æ ¼ä¼˜åŒ–
- **AIå›¾ç‰‡ç”Ÿæˆ**ï¼šé›†æˆDALL-Eã€Midjourney
- **AIè¯­éŸ³è½¬æ–‡å­—**ï¼šé›†æˆWhisper

#### 5. **åä½œåŠŸèƒ½ç¼ºå¤±**

**é—®é¢˜**ï¼š
- å•æœºåº”ç”¨ï¼Œæ— æ³•å¤šäººåä½œ

**å»ºè®®**ï¼ˆé•¿æœŸè§„åˆ’ï¼‰ï¼š
- äº‘ç«¯åŒæ­¥ï¼ˆç±»ä¼¼Notionï¼‰
- å®æ—¶åä½œç¼–è¾‘ï¼ˆWebSocket + CRDTï¼‰
- è¯„è®ºå’Œæ‰¹æ³¨åŠŸèƒ½

#### 6. **å¯¼å‡ºåŠŸèƒ½æœ‰é™**

**é—®é¢˜**ï¼š
- ä»…æ”¯æŒDOCXæ ¼å¼
- æ— æ³•å¯¼å‡ºå¯¹è¯è®°å½•

**å»ºè®®**ï¼š
- å¯¼å‡ºä¸ºPDFï¼ˆä½¿ç”¨ `puppeteer` æˆ– `pdfkit`ï¼‰
- å¯¼å‡ºä¸ºMarkdown
- å¯¼å‡ºå¯¹è¯ä¸ºHTML/Markdown
- æ‰¹é‡å¯¼å‡ºåŠŸèƒ½

### 5.3 æ€§èƒ½å±‚é¢

#### 1. **å¤§æ–‡ä»¶å¤„ç†æ€§èƒ½**

**é—®é¢˜**ï¼š
- æ‰“å¼€å¤§å‹DOCXæ–‡ä»¶ï¼ˆ>10MBï¼‰å¯èƒ½å¡é¡¿
- é€‰æ‹©å¤§é‡æ–‡ä»¶ä½œä¸ºä¸Šä¸‹æ–‡æ—¶å†…å­˜å ç”¨é«˜

**å»ºè®®**ï¼š
```typescript
// 1. è™šæ‹Ÿæ»šåŠ¨ï¼ˆæ–‡ä»¶æ ‘ï¼‰
import { FixedSizeList } from 'react-window'

// 2. åˆ†å—è¯»å–å¤§æ–‡ä»¶
async function readLargeFile(filePath: string) {
  const stream = fs.createReadStream(filePath, { highWaterMark: 64 * 1024 })
  // åˆ†å—å¤„ç†
}

// 3. Web Workerå¤„ç†æ–‡ä»¶å†…å®¹
const worker = new Worker('file-processor.worker.js')
worker.postMessage({ filePath, operation: 'parse' })
```

#### 2. **å¯¹è¯å†å²æ€§èƒ½**

**é—®é¢˜**ï¼š
- å¯¹è¯æ¶ˆæ¯æ•°é‡å¢é•¿åï¼Œæ¸²æŸ“å˜æ…¢
- æ‰€æœ‰å†å²å¯¹è¯éƒ½åŠ è½½åˆ°å†…å­˜

**å»ºè®®**ï¼š
```typescript
// 1. è™šæ‹Ÿæ»šåŠ¨ï¼ˆæ¶ˆæ¯åˆ—è¡¨ï¼‰
import { Virtuoso } from 'react-virtuoso'

<Virtuoso
  data={messages}
  itemContent={(index, message) => <MessageBubble message={message} />}
/>

// 2. åˆ†é¡µåŠ è½½å†å²å¯¹è¯
const conversations = await conversationHistory.getConversations({
  limit: 20,
  offset: page * 20
})

// 3. ç´¢å¼•æ•°æ®åº“ï¼ˆDexie.jsï¼‰
const db = new Dexie('ChatDatabase')
db.version(1).stores({
  messages: '++id, conversationId, timestamp, content'
})
```

#### 3. **Markdownæ¸²æŸ“æ€§èƒ½**

**é—®é¢˜**ï¼š
- å¤§é‡æ¶ˆæ¯åŒ…å«å¤æ‚Markdownæ—¶ï¼Œæ¸²æŸ“å¡é¡¿
- ä»£ç é«˜äº®åº“ï¼ˆreact-syntax-highlighterï¼‰ä½“ç§¯å¤§

**å»ºè®®**ï¼š
```typescript
// 1. æ‡’åŠ è½½ä»£ç é«˜äº®
const SyntaxHighlighter = lazy(() => import('react-syntax-highlighter'))

// 2. ä½¿ç”¨æ›´è½»é‡çš„é«˜äº®åº“
import { Highlight } from 'prism-react-renderer'

// 3. ä»…é«˜äº®å¯è§ä»£ç å—ï¼ˆIntersection Observerï¼‰
const CodeBlock = ({ code, language }) => {
  const ref = useRef()
  const isVisible = useIntersectionObserver(ref)
  
  return isVisible ? (
    <SyntaxHighlighter>{code}</SyntaxHighlighter>
  ) : (
    <pre ref={ref}>{code}</pre>
  )
}
```

### 5.4 ç”¨æˆ·ä½“éªŒå±‚é¢

#### 1. **åŠ è½½çŠ¶æ€ä¸æ˜ç¡®**

**é—®é¢˜**ï¼š
- AIè¯·æ±‚æ—¶ä»…æ˜¾ç¤º"æ­£åœ¨ç”Ÿæˆ..."
- æ–‡ä»¶è¯»å–æ—¶æ— loadingæŒ‡ç¤º

**å»ºè®®**ï¼š
```tsx
// 1. SkeletonåŠ è½½å ä½ç¬¦
<MessageBubble.Skeleton />

// 2. è¿›åº¦æŒ‡ç¤ºå™¨
<ProgressBar value={loadingProgress} />

// 3. æ›´è¯¦ç»†çš„çŠ¶æ€æç¤º
{isLoading && (
  <div>
    <Spinner />
    <p>æ­£åœ¨è¯»å–{selectedFiles.size}ä¸ªæ–‡ä»¶...</p>
  </div>
)}
```

#### 2. **é”™è¯¯æç¤ºç”¨æˆ·ä¸å‹å¥½**

**é—®é¢˜**ï¼š
- ä½¿ç”¨ `alert()` æ˜¾ç¤ºé”™è¯¯ï¼ˆé˜»å¡å¼ï¼‰
- é”™è¯¯ä¿¡æ¯æŠ€æœ¯æ€§å¤ªå¼º

**å»ºè®®**ï¼š
```tsx
// ä½¿ç”¨ toast é€šçŸ¥
import { toast } from 'react-hot-toast'

toast.error('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æƒé™', {
  duration: 4000,
  icon: 'âŒ'
})

// æˆ–è€…ä½¿ç”¨å†…è”é”™è¯¯æç¤º
<div className="error-banner">
  <AlertIcon />
  <div>
    <h4>æ“ä½œå¤±è´¥</h4>
    <p>æ— æ³•è¿æ¥åˆ°AIæœåŠ¡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®</p>
    <button onClick={retry}>é‡è¯•</button>
  </div>
</div>
```

#### 3. **ç¼ºä¹æ“ä½œå¼•å¯¼**

**é—®é¢˜**ï¼š
- æ–°ç”¨æˆ·ä¸çŸ¥é“å¦‚ä½•å¼€å§‹
- æ²¡æœ‰æ¬¢è¿é¡µé¢æˆ–æ•™ç¨‹

**å»ºè®®**ï¼š
```tsx
// 1. é¦–æ¬¡ä½¿ç”¨å¼•å¯¼
import { Joyride } from 'react-joyride'

const steps = [
  {
    target: '.file-tree',
    content: 'è¿™é‡Œæ˜¯æ–‡ä»¶ç®¡ç†åŒºï¼Œæ‚¨å¯ä»¥é€‰æ‹©å·¥ä½œç›®å½•'
  },
  {
    target: '.chat-panel',
    content: 'å³ä¾§æ˜¯AIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®æ‚¨å†™ä½œå’Œåˆ†ææ–‡æ¡£'
  }
]

// 2. ç©ºçŠ¶æ€æç¤º
{files.length === 0 && (
  <EmptyState
    icon={<FolderIcon />}
    title="è¿˜æ²¡æœ‰æ‰“å¼€å·¥ä½œç›®å½•"
    description="ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©ä¸€ä¸ªç›®å½•å¼€å§‹"
    action={<Button onClick={selectDirectory}>é€‰æ‹©ç›®å½•</Button>}
  />
)}
```

#### 4. **å›½é™…åŒ–ç¼ºå¤±**

**é—®é¢˜**ï¼š
- æ‰€æœ‰æ–‡æœ¬ç¡¬ç¼–ç ä¸ºä¸­æ–‡
- æ— æ³•åˆ‡æ¢è¯­è¨€

**å»ºè®®**ï¼š
```typescript
// ä½¿ç”¨ react-i18next
import { useTranslation } from 'react-i18next'

const { t } = useTranslation()

<button>{t('common.save')}</button>  // "ä¿å­˜" or "Save"
```

#### 5. **ä¸»é¢˜ç³»ç»Ÿç¼ºå¤±**

**é—®é¢˜**ï¼š
- ä»…æ”¯æŒæµ…è‰²ä¸»é¢˜
- æ— æ³•è‡ªå®šä¹‰é¢œè‰²

**å»ºè®®**ï¼š
```typescript
// ä½¿ç”¨CSSå˜é‡ + ä¸»é¢˜åˆ‡æ¢
const themes = {
  light: {
    '--bg-primary': '#ffffff',
    '--text-primary': '#1f2937'
  },
  dark: {
    '--bg-primary': '#1f2937',
    '--text-primary': '#f9fafb'
  }
}

// åº”ç”¨ä¸»é¢˜
document.documentElement.style.cssText = Object.entries(themes[currentTheme])
  .map(([key, value]) => `${key}: ${value}`)
  .join(';')
```

### 5.5 æµ‹è¯•å±‚é¢

#### 1. **å®Œå…¨ç¼ºä¹æµ‹è¯•**

**é—®é¢˜**ï¼š
- æ— å•å…ƒæµ‹è¯•
- æ— é›†æˆæµ‹è¯•
- æ— E2Eæµ‹è¯•

**å»ºè®®**ï¼š
```typescript
// 1. å•å…ƒæµ‹è¯•ï¼ˆVitestï¼‰
describe('ContextEngine', () => {
  it('should limit history messages', () => {
    const messages = createMockMessages(100)
    const result = contextEngine.buildRequestMessages(messages, {
      ...config,
      historyLimit: 10
    })
    expect(result).toHaveLength(10)
  })
})

// 2. ç»„ä»¶æµ‹è¯•ï¼ˆReact Testing Libraryï¼‰
test('ChatInput sends message on Enter', async () => {
  const onSend = vi.fn()
  render(<ChatInput onSend={onSend} />)
  
  const input = screen.getByRole('textbox')
  await userEvent.type(input, 'Hello{Enter}')
  
  expect(onSend).toHaveBeenCalledWith('Hello')
})

// 3. E2Eæµ‹è¯•ï¼ˆPlaywrightï¼‰
test('user can create new file', async () => {
  await app.launch()
  await page.click('.select-directory')
  await page.click('.create-file')
  await page.fill('.file-name-input', 'test.txt')
  await page.click('.confirm')
  
  await expect(page.locator('.file-tree-node:text("test.txt")')).toBeVisible()
})
```

### 5.6 æ–‡æ¡£å±‚é¢

#### 1. **READMEè¿‡äºç®€æ´**

**å½“å‰README**ï¼š
- ä»…æœ‰åŸºæœ¬çš„å®‰è£…å’Œè¿è¡Œå‘½ä»¤
- ç¼ºå°‘åŠŸèƒ½ä»‹ç»
- ç¼ºå°‘æ¶æ„è¯´æ˜

**å»ºè®®è¡¥å……**ï¼š
```markdown
# AIå†™ä½œåŠ©æ‰‹

## åŠŸèƒ½ç‰¹æ€§
- âœ… æ–‡æ¡£ç¼–è¾‘ä¸AIå¯¹è¯æ·±åº¦æ•´åˆ
- âœ… æ”¯æŒDOCX/TXT/MDæ ¼å¼
- âœ… å¤šAIæä¾›å•†æ”¯æŒï¼ˆOpenAIã€Geminiï¼‰
...

## å¿«é€Ÿå¼€å§‹
### å®‰è£…ä¾èµ–
...

### é…ç½®AI API
...

## æ¶æ„è®¾è®¡
...

## å¼€å‘æŒ‡å—
...

## å¸¸è§é—®é¢˜
...
```

#### 2. **ç¼ºä¹APIæ–‡æ¡£**

**é—®é¢˜**ï¼š
- æ ¸å¿ƒç±»å’Œå‡½æ•°ç¼ºå°‘JSDocæ³¨é‡Š
- ç±»å‹å®šä¹‰ç¼ºå°‘è¯´æ˜

**å»ºè®®**ï¼š
```typescript
/**
 * ä¸Šä¸‹æ–‡å¼•æ“ - ç®¡ç†AIå¯¹è¯çš„ä¸Šä¸‹æ–‡æ„å»º
 * 
 * @example
 * ```ts
 * const messages = contextEngine.buildRequestMessages(
 *   history,
 *   config,
 *   tempContent,
 *   'after_system'
 * )
 * ```
 */
export class ContextEngine {
  /**
   * æ„å»ºè¯·æ±‚æ¶ˆæ¯
   * 
   * @param history - å¯¹è¯å†å²
   * @param config - AIé…ç½®
   * @param tempContent - ä¸´æ—¶ä¸Šä¸‹æ–‡å†…å®¹ï¼ˆå¯é€‰ï¼‰
   * @param tempPlacement - ä¸´æ—¶å†…å®¹æ”¾ç½®ä½ç½®
   * @returns æœ€ç»ˆçš„è¯·æ±‚æ¶ˆæ¯åˆ—è¡¨
   */
  buildRequestMessages(
    history: FlatMessage[],
    config: AIConfig,
    tempContent?: string,
    tempPlacement: TempContextPlacement = 'append'
  ): RequestMessage[] {
    // ...
  }
}
```

#### 3. **ç¼ºä¹æ›´æ–°æ—¥å¿—**

**å»ºè®®**ï¼š
- åˆ›å»º `CHANGELOG.md`
- æ¯ä¸ªç‰ˆæœ¬è®°å½•æ–°å¢åŠŸèƒ½ã€ä¿®å¤Bugã€ç ´åæ€§å˜æ›´

### 5.7 å®‰å…¨å±‚é¢

#### 1. **APIå¯†é’¥å­˜å‚¨ä¸å®‰å…¨**

**é—®é¢˜**ï¼š
- APIå¯†é’¥ä»¥æ˜æ–‡å­˜å‚¨åœ¨JSONæ–‡ä»¶ä¸­
- ä»»ä½•èƒ½è®¿é—®æ–‡ä»¶ç³»ç»Ÿçš„ç¨‹åºéƒ½èƒ½è¯»å–

**å»ºè®®**ï¼š
```javascript
// ä½¿ç”¨Electronçš„safeStorage APIï¼ˆElectron 16+ï¼‰
const { safeStorage } = require('electron')

// åŠ å¯†å­˜å‚¨
const encryptedKey = safeStorage.encryptString(apiKey)
await storage.set('api_key_encrypted', encryptedKey.toString('base64'))

// è¯»å–è§£å¯†
const encrypted = await storage.get('api_key_encrypted')
const apiKey = safeStorage.decryptString(Buffer.from(encrypted, 'base64'))
```

#### 2. **ç¼ºä¹è¾“å…¥éªŒè¯**

**é—®é¢˜**ï¼š
- æ–‡ä»¶è·¯å¾„ã€APIå¯†é’¥ç­‰è¾“å…¥ç¼ºå°‘éªŒè¯
- å¯èƒ½å¯¼è‡´æ³¨å…¥æ”»å‡»æˆ–å´©æºƒ

**å»ºè®®**ï¼š
```typescript
// éªŒè¯æ–‡ä»¶è·¯å¾„
function validateFilePath(filePath: string) {
  if (!path.isAbsolute(filePath)) {
    throw new Error('å¿…é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„')
  }
  if (filePath.includes('..')) {
    throw new Error('è·¯å¾„ä¸èƒ½åŒ…å«".."')
  }
  return filePath
}

// éªŒè¯APIå¯†é’¥æ ¼å¼
function validateApiKey(key: string, provider: string) {
  const patterns = {
    openai: /^sk-[a-zA-Z0-9]{32,}$/,
    gemini: /^[a-zA-Z0-9_-]{20,}$/
  }
  if (!patterns[provider].test(key)) {
    throw new Error('APIå¯†é’¥æ ¼å¼ä¸æ­£ç¡®')
  }
}
```

#### 3. **CSPç¼ºå¤±**

**é—®é¢˜**ï¼š
- æœªè®¾ç½®Content Security Policy
- å¯èƒ½é­å—XSSæ”»å‡»

**å»ºè®®**ï¼š
```javascript
// Electronä¸»è¿›ç¨‹
session.defaultSession.webRequest.onHeadersReceived((details, callback) => {
  callback({
    responseHeaders: {
      ...details.responseHeaders,
      'Content-Security-Policy': [
        "default-src 'self';",
        "script-src 'self' 'unsafe-inline';",  // Reactéœ€è¦inline scripts
        "style-src 'self' 'unsafe-inline';",
        "img-src 'self' data:;",
        "connect-src 'self' https://api.openai.com https://generativelanguage.googleapis.com"
      ].join(' ')
    }
  })
})
```

---

## å…­ã€æ”¹è¿›å»ºè®®ä¸ä¼˜å…ˆçº§

### 6.1 çŸ­æœŸæ”¹è¿›ï¼ˆ1-2å‘¨ï¼‰

#### ä¼˜å…ˆçº§P0ï¼ˆå¿…é¡»ä¿®å¤ï¼‰

1. **æ·»åŠ é”™è¯¯è¾¹ç•Œ**
   ```tsx
   <ErrorBoundary fallback={<ErrorPage />}>
     <App />
   </ErrorBoundary>
   ```

2. **ä¼˜åŒ–é”™è¯¯æç¤º**
   - ç”¨ `react-hot-toast` æ›¿ä»£ `alert()`
   - ç»Ÿä¸€é”™è¯¯æ ¼å¼

3. **æ·»åŠ åŠ è½½çŠ¶æ€**
   - æ–‡ä»¶è¯»å–loading
   - AIè¯·æ±‚loading
   - Skeletonå ä½ç¬¦

#### ä¼˜å…ˆçº§P1ï¼ˆé‡è¦ä¼˜åŒ–ï¼‰

1. **æ·»åŠ å¿«æ·é”®ç³»ç»Ÿ**
   - Ctrl+N æ–°å»ºæ–‡ä»¶
   - Ctrl+F æœç´¢
   - Ctrl+Shift+P å‘½ä»¤é¢æ¿

2. **å®Œå–„æ–‡æ¡£**
   - è¡¥å……README
   - æ·»åŠ ä½¿ç”¨æ•™ç¨‹
   - åˆ›å»ºCHANGELOG

3. **APIå¯†é’¥åŠ å¯†å­˜å‚¨**
   - ä½¿ç”¨ `safeStorage` API
   - è¿ç§»ç°æœ‰å¯†é’¥

### 6.2 ä¸­æœŸæ”¹è¿›ï¼ˆ1-2ä¸ªæœˆï¼‰

#### ä¼˜å…ˆçº§P1ï¼ˆé‡è¦åŠŸèƒ½ï¼‰

1. **å¼•å…¥çŠ¶æ€ç®¡ç†**
   - ä½¿ç”¨Zustand
   - é‡æ„å…±äº«çŠ¶æ€

2. **æ–‡ä»¶ç›‘å¬**
   - ä½¿ç”¨chokidar
   - è‡ªåŠ¨åˆ·æ–°æ–‡ä»¶æ ‘
   - æ£€æµ‹ç¼–è¾‘å†²çª

3. **æœç´¢åŠŸèƒ½**
   - æ–‡ä»¶åæœç´¢
   - å…¨æ–‡æœç´¢ï¼ˆripgrepï¼‰
   - å¯¹è¯å†å²æœç´¢

4. **å¯¼å‡ºåŠŸèƒ½**
   - å¯¼å‡ºä¸ºPDF
   - å¯¼å‡ºä¸ºMarkdown
   - æ‰¹é‡å¯¼å‡º

#### ä¼˜å…ˆçº§P2ï¼ˆä½“éªŒä¼˜åŒ–ï¼‰

1. **ä¸»é¢˜ç³»ç»Ÿ**
   - æ·±è‰²æ¨¡å¼
   - ä¸»é¢˜è‡ªå®šä¹‰

2. **å›½é™…åŒ–**
   - è‹±æ–‡æ”¯æŒ
   - å¤šè¯­è¨€åˆ‡æ¢

3. **é¦–æ¬¡ä½¿ç”¨å¼•å¯¼**
   - æ¬¢è¿é¡µé¢
   - åŠŸèƒ½å¯¼è§ˆ

### 6.3 é•¿æœŸè§„åˆ’ï¼ˆ3-6ä¸ªæœˆï¼‰

#### ä¼˜å…ˆçº§P1ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

1. **å‡çº§ç¼–è¾‘å™¨**
   - å¼•å…¥Lexicalæˆ–ProseMirror
   - æ”¯æŒåä½œç¼–è¾‘
   - å®Œå–„çš„æ’¤é”€/é‡åš

2. **æ’ä»¶ç³»ç»Ÿ**
   - è®¾è®¡æ’ä»¶API
   - æ’ä»¶å¸‚åœº

3. **AIåŠŸèƒ½æ‰©å±•**
   - AIç»­å†™/æ”¹å†™/æ€»ç»“
   - AIç¿»è¯‘
   - AIæ¶¦è‰²
   - å›¾ç‰‡ç”Ÿæˆé›†æˆ

#### ä¼˜å…ˆçº§P2ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰

1. **äº‘åŒæ­¥**
   - è´¦æˆ·ç³»ç»Ÿ
   - å¤šè®¾å¤‡åŒæ­¥
   - ç‰ˆæœ¬å†å²

2. **æ€§èƒ½ä¼˜åŒ–**
   - è™šæ‹Ÿæ»šåŠ¨
   - Web Worker
   - æ•°æ®åº“ç´¢å¼•

3. **æµ‹è¯•è¦†ç›–**
   - å•å…ƒæµ‹è¯•ï¼ˆ80%è¦†ç›–ç‡ï¼‰
   - E2Eæµ‹è¯•ï¼ˆæ ¸å¿ƒæµç¨‹ï¼‰
   - CI/CDé›†æˆ

---

## ä¸ƒã€æŠ€æœ¯å€ºåŠ¡æ¸…å•

### 7.1 ä»£ç è´¨é‡

| é—®é¢˜ | å½±å“ | ä¼˜å…ˆçº§ | é¢„è®¡å·¥ä½œé‡ |
|------|------|--------|----------|
| ç¼ºä¹TypeScriptä¸¥æ ¼æ¨¡å¼ | ç±»å‹å®‰å…¨æ€§ä¸è¶³ | P2 | 2å¤© |
| éƒ¨åˆ†ç»„ä»¶èŒè´£ä¸æ¸… | å¯ç»´æŠ¤æ€§å·® | P2 | 3å¤© |
| ç¼ºå°‘ä»£ç æ³¨é‡Š | å¯è¯»æ€§å·® | P3 | 5å¤© |
| ESLintè§„åˆ™ä¸ä¸¥æ ¼ | ä»£ç é£æ ¼ä¸ä¸€è‡´ | P3 | 1å¤© |

**å»ºè®®**ï¼š
```typescript
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,              // å¯ç”¨æ‰€æœ‰ä¸¥æ ¼æ£€æŸ¥
    "noUncheckedIndexedAccess": true,
    "noImplicitReturns": true
  }
}
```

### 7.2 ä¾èµ–ç®¡ç†

| é—®é¢˜ | å½±å“ | å»ºè®® |
|------|------|------|
| React 19.1.0ï¼ˆéç¨³å®šç‰ˆï¼‰ | å¯èƒ½æœ‰bug | é™çº§åˆ°18.xç¨³å®šç‰ˆ |
| Tailwind CSS 4.0ï¼ˆbetaï¼‰ | ç”Ÿäº§ç¯å¢ƒé£é™© | é™çº§åˆ°3.x |
| éƒ¨åˆ†ä¾èµ–ç‰ˆæœ¬å›ºå®š | æ— æ³•è·å–å®‰å…¨æ›´æ–° | ä½¿ç”¨ `^` ç‰ˆæœ¬èŒƒå›´ |

**å»ºè®®**ï¼š
```bash
# å®šæœŸæ›´æ–°ä¾èµ–
npm outdated
npm update

# æ£€æŸ¥å®‰å…¨æ¼æ´
npm audit
npm audit fix
```

### 7.3 æ„å»ºä¼˜åŒ–

| é—®é¢˜ | å½±å“ | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| åˆå§‹åŒ…ä½“ç§¯å¤§ | é¦–å±åŠ è½½æ…¢ | ä»£ç åˆ†å‰²ã€æ‡’åŠ è½½ |
| æœªä½¿ç”¨tree-shaking | åŒ…å«æœªä½¿ç”¨ä»£ç  | æ£€æŸ¥å¯¼å…¥æ–¹å¼ |
| Source Mapè¿‡å¤§ | ç”Ÿäº§ç¯å¢ƒä½“ç§¯å¤§ | ç”Ÿäº§ç¯å¢ƒç¦ç”¨æˆ–ä½¿ç”¨hidden-source-map |

**å»ºè®®**ï¼š
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    sourcemap: isProd ? false : true,
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    }
  }
})
```

---

## å…«ã€ç«å“å¯¹æ¯”

### 8.1 ä¸»è¦ç«å“

| äº§å“ | å®šä½ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|------|------|------|------|
| **Notion AI** | ç¬”è®°+AI | äº‘ç«¯åŒæ­¥ã€åä½œå¼ºå¤§ | éœ€è¦ç½‘ç»œã€éšç§æ‹…å¿§ |
| **Cursor** | ä»£ç ç¼–è¾‘å™¨+AI | ä¸“ä¸ºç¼–ç¨‹è®¾è®¡ | ä¸é€‚åˆæ™®é€šæ–‡æ¡£å†™ä½œ |
| **ChatGPT Desktop** | AIå¯¹è¯ | OpenAIå®˜æ–¹ã€åŠŸèƒ½å¼ºå¤§ | ç¼ºå°‘æ–‡æ¡£ç¼–è¾‘åŠŸèƒ½ |
| **Obsidian + AIæ’ä»¶** | ç¬”è®°+AI | æœ¬åœ°ä¼˜å…ˆã€æ’ä»¶ä¸°å¯Œ | AIé›†æˆä¸æ·±å…¥ |

### 8.2 æœ¬é¡¹ç›®çš„å·®å¼‚åŒ–ä¼˜åŠ¿

1. **æ·±åº¦æ•´åˆ**
   - æ–‡æ¡£ç¼–è¾‘ã€æ–‡ä»¶ç®¡ç†ã€AIå¯¹è¯æ— ç¼é›†æˆ
   - å¤šæ–‡ä»¶ä¸Šä¸‹æ–‡æ”¯æŒ

2. **æœ¬åœ°ä¼˜å…ˆ**
   - æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°
   - æ— éœ€æ³¨å†Œè´¦å·
   - éšç§å®‰å…¨

3. **çµæ´»çš„AIé…ç½®**
   - æ”¯æŒå¤šç§AIæä¾›å•†
   - å¯å¯¹æ¥æœ¬åœ°æ¨¡å‹
   - æç¤ºè¯å¡ç‰‡ç³»ç»Ÿ

4. **å¼€æºå…è´¹**
   - å®Œå…¨å¼€æº
   - å¯è‡ªå®šä¹‰ä¿®æ”¹
   - ç¤¾åŒºé©±åŠ¨

### 8.3 å¯å­¦ä¹ ä¹‹å¤„

1. **Notion**
   - å—ç¼–è¾‘å™¨ï¼ˆBlock Editorï¼‰è®¾è®¡
   - æ–œæ å‘½ä»¤ï¼ˆ/å‘½ä»¤é¢æ¿ï¼‰
   - ä¸°å¯Œçš„æ¨¡æ¿ç³»ç»Ÿ

2. **Cursor**
   - AIè¾…åŠ©ä»£ç è¡¥å…¨
   - ä»£ç diffå±•ç¤º
   - å¿«æ·çš„AIè°ƒç”¨æ–¹å¼ï¼ˆCmd+Kï¼‰

3. **Obsidian**
   - åŒå‘é“¾æ¥
   - å›¾è°±è§†å›¾
   - å¼ºå¤§çš„æ’ä»¶ç”Ÿæ€

---

## ä¹ã€æ€»ç»“

### 9.1 é¡¹ç›®è¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **æ¶æ„è®¾è®¡** | â­â­â­â­ (8/10) | ContextEngineè®¾è®¡ä¼˜ç§€ï¼Œæ¨¡å—åŒ–æ¸…æ™°ï¼›ä½†ç¼ºä¹å…¨å±€çŠ¶æ€ç®¡ç† |
| **ä»£ç è´¨é‡** | â­â­â­ (7/10) | TypeScriptä½¿ç”¨è§„èŒƒï¼Œä½†ç¼ºå°‘æ³¨é‡Šå’Œæµ‹è¯• |
| **åŠŸèƒ½å®Œæ•´æ€§** | â­â­â­â­ (7.5/10) | æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼Œä½†ç¼ºå°‘æœç´¢ã€å¯¼å‡ºç­‰è¾…åŠ©åŠŸèƒ½ |
| **ç”¨æˆ·ä½“éªŒ** | â­â­â­ (6.5/10) | åŸºç¡€åŠŸèƒ½æ˜“ç”¨ï¼Œä½†é”™è¯¯æç¤ºã€åŠ è½½çŠ¶æ€éœ€æ”¹è¿› |
| **æ€§èƒ½è¡¨ç°** | â­â­â­ (7/10) | å°æ–‡ä»¶æµç•…ï¼Œå¤§æ–‡ä»¶å’Œé•¿å¯¹è¯æ€§èƒ½æœ‰å¾…ä¼˜åŒ– |
| **æ–‡æ¡£è´¨é‡** | â­â­ (4/10) | READMEè¿‡äºç®€æ´ï¼Œç¼ºå°‘æ¶æ„æ–‡æ¡£å’ŒAPIæ–‡æ¡£ |
| **å¯ç»´æŠ¤æ€§** | â­â­â­â­ (8/10) | æ¨¡å—åŒ–å¥½ï¼Œä½†ç¼ºå°‘æµ‹è¯•é™ä½ä¿¡å¿ƒ |

**ç»¼åˆè¯„åˆ†ï¼š7.1/10**

### 9.2 æ ¸å¿ƒäº®ç‚¹æ€»ç»“

1. **ContextEngineè®¾è®¡** - å±•ç¤ºäº†ä¼˜ç§€çš„è½¯ä»¶å·¥ç¨‹èƒ½åŠ›
2. **æ ‘å½¢å¯¹è¯ç»“æ„** - åˆ›æ–°çš„å¯¹è¯ç®¡ç†æ–¹å¼
3. **å¤šæ–‡ä»¶ä¸Šä¸‹æ–‡** - å®ç”¨çš„å·®å¼‚åŒ–åŠŸèƒ½
4. **æç¤ºè¯å¡ç‰‡ç³»ç»Ÿ** - çµæ´»çš„æç¤ºè¯ç®¡ç†
5. **æ¨¡å—åŒ–æ¶æ„** - æ¸…æ™°çš„èŒè´£åˆ’åˆ†

### 9.3 ä¸»è¦ä¸è¶³æ€»ç»“

1. **ç¼ºä¹æµ‹è¯•** - æœ€ä¸¥é‡çš„é—®é¢˜ï¼Œå½±å“é•¿æœŸç»´æŠ¤
2. **é”™è¯¯å¤„ç†ç®€é™‹** - å½±å“ç”¨æˆ·ä½“éªŒ
3. **æ€§èƒ½ä¼˜åŒ–ä¸è¶³** - å¤§æ–‡ä»¶å’Œé•¿å¯¹è¯åœºæ™¯
4. **æ–‡æ¡£ç¼ºå¤±** - å½±å“åä½œå’Œè´¡çŒ®
5. **å®‰å…¨æ€§ä¸è¶³** - APIå¯†é’¥æ˜æ–‡å­˜å‚¨

### 9.4 å»ºè®®å‘å±•æ–¹å‘

#### çŸ­æœŸï¼ˆ1-2ä¸ªæœˆï¼‰ï¼šç¨³å®šæ€§ä¸ä½“éªŒ
- è¡¥å…¨åŸºç¡€åŠŸèƒ½ï¼ˆæœç´¢ã€å¯¼å‡ºï¼‰
- ä¼˜åŒ–é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€
- å®Œå–„æ–‡æ¡£å’Œæ•™ç¨‹
- æ·»åŠ æµ‹è¯•è¦†ç›–

#### ä¸­æœŸï¼ˆ3-6ä¸ªæœˆï¼‰ï¼šåŠŸèƒ½æ‰©å±•
- å¼•å…¥ä¸“ä¸šç¼–è¾‘å™¨
- å®ç°æ’ä»¶ç³»ç»Ÿ
- æ‰©å±•AIèƒ½åŠ›ï¼ˆç¿»è¯‘ã€æ¶¦è‰²ã€å›¾ç‰‡ï¼‰
- æ€§èƒ½ä¼˜åŒ–

#### é•¿æœŸï¼ˆ6-12ä¸ªæœˆï¼‰ï¼šç”Ÿæ€å»ºè®¾
- äº‘åŒæ­¥ä¸åä½œ
- æ’ä»¶å¸‚åœº
- å¤šå¹³å°ä¼˜åŒ–ï¼ˆç§»åŠ¨ç«¯ï¼‰
- ä¼ä¸šç‰ˆåŠŸèƒ½ï¼ˆå›¢é˜Ÿç®¡ç†ã€æƒé™æ§åˆ¶ï¼‰

---

## åã€é™„å½•

### 10.1 æŠ€æœ¯æ ˆè¯¦ç»†æ¸…å•

#### æ ¸å¿ƒä¾èµ–
- `electron`: 37.2.4 - æ¡Œé¢åº”ç”¨æ¡†æ¶
- `react`: 19.1.0 - UIæ¡†æ¶
- `react-dom`: 19.1.0 - React DOMæ¸²æŸ“
- `typescript`: 5.8.3 - ç±»å‹ç³»ç»Ÿ
- `vite`: 6.3.5 - æ„å»ºå·¥å…·

#### UIç»„ä»¶
- `tailwindcss`: 4.0.0 - CSSæ¡†æ¶
- `react-resizable-panels`: 3.0.4 - å¯è°ƒæ•´å¤§å°çš„é¢æ¿
- `react-markdown`: 10.1.0 - Markdownæ¸²æŸ“
- `react-syntax-highlighter`: 15.6.1 - ä»£ç é«˜äº®
- `rehype-katex`: 7.0.1 - æ•°å­¦å…¬å¼æ¸²æŸ“
- `remark-gfm`: 4.0.1 - GitHubé£æ ¼Markdown
- `remark-math`: 6.0.0 - æ•°å­¦å…¬å¼è§£æ

#### æ–‡æ¡£å¤„ç†
- `docx`: 9.5.1 - DOCXæ–‡ä»¶ç”Ÿæˆ
- `mammoth`: 1.9.1 - DOCXè½¬HTML
- `html-to-docx`: 1.8.0 - HTMLè½¬DOCXï¼ˆå¤‡ç”¨ï¼‰

#### å¼€å‘å·¥å…·
- `@vitejs/plugin-react`: 4.4.1 - Vite Reactæ’ä»¶
- `electron-builder`: 26.0.12 - Electronæ‰“åŒ…å·¥å…·
- `concurrently`: 9.2.0 - å¹¶è¡Œè¿è¡Œå‘½ä»¤
- `wait-on`: 8.0.4 - ç­‰å¾…æœåŠ¡å¯åŠ¨
- `eslint`: 9.25.0 - ä»£ç æ£€æŸ¥
- `typescript-eslint`: 8.30.1 - TypeScript ESLint

### 10.2 é¡¹ç›®ç»Ÿè®¡

#### ä»£ç è§„æ¨¡ï¼ˆä¼°ç®—ï¼‰
- æ€»è¡Œæ•°ï¼š~8000è¡Œ
- TypeScriptï¼š~5500è¡Œ
- JavaScriptï¼ˆElectronï¼‰ï¼š~1500è¡Œ
- CSS/SCSSï¼š~500è¡Œ
- é…ç½®æ–‡ä»¶ï¼š~500è¡Œ

#### æ–‡ä»¶æ•°é‡
- æºæ–‡ä»¶ï¼š~60ä¸ª
- ç»„ä»¶ï¼š~25ä¸ª
- Hooksï¼š~8ä¸ª
- å·¥å…·å‡½æ•°ï¼š~15ä¸ª

#### æ¨¡å—åˆ’åˆ†
```
src/
â”œâ”€â”€ chat/              ~2500è¡Œ (AIå¯¹è¯ç³»ç»Ÿ)
â”œâ”€â”€ writing/           ~1500è¡Œ (æ–‡æ¡£ç¼–è¾‘)
â”œâ”€â”€ prompt/            ~800è¡Œ (æç¤ºè¯ç®¡ç†)
â”œâ”€â”€ md-html-dock/      ~600è¡Œ (æ–‡æ¡£æ¸²æŸ“)
â””â”€â”€ storage/           ~200è¡Œ (å­˜å‚¨å°è£…)

electron/              ~1500è¡Œ
â”œâ”€â”€ main.js            ~120è¡Œ
â”œâ”€â”€ window.js          ~200è¡Œ
â”œâ”€â”€ storage.js         ~230è¡Œ
â”œâ”€â”€ file-system.js     ~250è¡Œ
â”œâ”€â”€ GlobalContextMenu.js ~400è¡Œ
â””â”€â”€ converters/docx.js ~300è¡Œ
```

### 10.3 å‚è€ƒèµ„æº

#### å®˜æ–¹æ–‡æ¡£
- [Electronæ–‡æ¡£](https://www.electronjs.org/docs)
- [Reactæ–‡æ¡£](https://react.dev)
- [TypeScriptæ–‡æ¡£](https://www.typescriptlang.org/docs)
- [Viteæ–‡æ¡£](https://vitejs.dev)

#### ç›¸å…³é¡¹ç›®
- [Electron Vite Boilerplate](https://github.com/electron-vite/electron-vite-vue)
- [React Markdown](https://github.com/remarkjs/react-markdown)
- [docxåº“](https://github.com/dolanmiu/docx)

#### å­¦ä¹ èµ„æº
- [Electronå®‰å…¨æœ€ä½³å®è·µ](https://www.electronjs.org/docs/latest/tutorial/security)
- [Reactæ€§èƒ½ä¼˜åŒ–](https://react.dev/reference/react/memo)
- [TypeScriptç±»å‹ç¼–ç¨‹](https://www.typescriptlang.org/docs/handbook/2/types-from-types.html)

---

**åˆ†æå®Œæˆæ—¥æœŸ**ï¼š2025å¹´10æœˆ2æ—¥  
**åˆ†æäººå‘˜**ï¼šAI Coding Assistant  
**ç‰ˆæœ¬**ï¼šv1.0

> æœ¬åˆ†ææŠ¥å‘ŠåŸºäºé¡¹ç›®ä»£ç å¿«ç…§ï¼Œéšç€é¡¹ç›®æ¼”è¿›ï¼Œéƒ¨åˆ†å†…å®¹å¯èƒ½éœ€è¦æ›´æ–°ã€‚å»ºè®®å®šæœŸé‡æ–°è¯„ä¼°é¡¹ç›®çŠ¶æ€ã€‚

